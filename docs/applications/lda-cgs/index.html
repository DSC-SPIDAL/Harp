<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="Latent Dirichlet Allocation (CGS)"><meta property="og:url" content="/docs/applications/lda-cgs/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Latent Dirichlet Allocation (CGS)</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png" width="76%"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Documentation</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion-1" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="installation-guide" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-1" href="#collapse-installation-guide" aria-labelledby="installation-guide"><i class="fa fa-caret-right"></i>Installation Guide</a></h4></section><div id="collapse-installation-guide" class="panel-collapse collapse" aria-labelledby="installation-guide"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/prerequisites">Prerequisites</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation (Single Node)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started-cluster">Harp Installation (Cluster)</a></li></ul></div></div></div></div></nav><nav class="hn-sidebar-nav"><div id="hn-accordion-2" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="beginners-guide" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-2" href="#collapse-beginners-guide" aria-labelledby="beginners-guide"><i class="fa fa-caret-right"></i>Beginners Guide</a></h4></section><div id="collapse-beginners-guide" class="panel-collapse collapse" aria-labelledby="beginners-guide"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/beginnersguide/mlr">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/beginnersguide/svm">Support Vector Machine</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Users Guide</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-2" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-2" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/mf">Matrix Factorization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/sahad">Subgraph Counting</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Contributors Guide</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-3" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">Broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">Reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">Allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">Allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">Regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">Push &amp; Pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">Rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/rf">Random Forests</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/nn">Neural Network</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Harp-DAAL Documentation</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-4" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="overview" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-overview" aria-labelledby="overview"><i class="fa fa-caret-right"></i>Overview</a></h4></section><div id="collapse-overview" class="panel-collapse collapse" aria-labelledby="overview"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Harp-DAAL framework</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal-api" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-harp-daal-api" aria-labelledby="harp-daal-api"><i class="fa fa-caret-right"></i>Harp-DAAL API</a></h4></section><div id="collapse-harp-daal-api" class="panel-collapse collapse" aria-labelledby="harp-daal-api"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaalInit">Initialization Module</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaalIO">I/O Module</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaalComm">Communication Module</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/BatchModeEg">Batch Mode Code Walk Through</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/DistriModeEg">Distributed Mode Code Walk Through</a></li></ul></div></div></div><div class="panel panel-default"><section id="algorithm" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-algorithm" aria-labelledby="algorithm"><i class="fa fa-caret-right"></i>Algorithm</a></h4></section><div id="collapse-algorithm" class="panel-collapse collapse" aria-labelledby="algorithm"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#arpos">Association Rule</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#covpos">Covariance</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#boostpos">Boosting</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#naivepos">Naive Bayes Classifier</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#kmeanspos">K-Means Clustering</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#empos">Expectation-Maximization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#pcapos">Principal Component Analysis</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#svdpos">Singular Value Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#qrpos">QR Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#pqrpos">Pivoted-QR Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#ckdpos">Cholesky Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#mompos">Low Order Moments</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#odpos">Outlier Detection</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#sortpos">Sorting</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#qtepos">Quantile</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#qmpos">Quality Metrics</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#optpos">Optimization Solvers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#normpos">Normalization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#svmpos">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#knnpos">K-Nearest Neighbors Classifier</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#dtreepos">Decision Tree</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#dforestpos">Decision Forest</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#kernelfuncpos">Kernel Functions</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#stumppos">Stump Weak Learner Classifier</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#linregpos">Linear Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#reregpos">Ridge Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#alspos">Implicit Alternating Least Squares</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#nnpos">Neural Network</a></li></ul></div></div></div><div class="panel panel-default"><section id="application" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-application" aria-labelledby="application"><i class="fa fa-caret-right"></i>Application</a></h4></section><div id="collapse-application" class="panel-collapse collapse" aria-labelledby="application"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/MF-SGD">Recommender System based on SGD</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Subgraph">Subgraph Counting</a></li></ul></div></div></div><div class="panel panel-default"><section id="hands-on" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-hands-on" aria-labelledby="hands-on"><i class="fa fa-caret-right"></i>Hands-on</a></h4></section><div id="collapse-hands-on" class="panel-collapse collapse" aria-labelledby="hands-on"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/handson">Tutorial</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Latent Dirichlet Allocation (CGS)</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p><img src="https://dsc-spidal.github.io/harp/img/lda-cgs-illustration.png" width="30%"  ></p>

<h1 id="understanding-cgs-lda-algorithm">Understanding CGS LDA algorithm</h1>

<p><img src="https://dsc-spidal.github.io/harp/img/lda-description.png" width="100%" ></p>

<h3 id="pseudo-code-for-cgs-lda-algorithm">Pseudo code for CGS LDA algorithm:</h3>

<p><img src="https://dsc-spidal.github.io/harp/img/cgs-algorithm.png" width="80%" ></p>

<h1 id="using-model-rotation-to-parallel-lda-algorithm">Using Model Rotation to parallel LDA algorithm</h1>

<p>Model rotation is expressed as a collective communication. The operation takes the model part owned by a process and performs the rotation.
By default, the operation sends the model partitions to the next neighbor and receives the model partitions from the last neighbor in a predefined ring
topology of workers. An advanced option is that the ring topology can be dynamically defined before performing the model rotation. Thus programming model rotation requires just one API.
For local computations inside each worker, they are simply programmed through an interface of “schedule-update”. A scheduler employs a user-defined function to maintain a dynamic order of
model parameter updates and to avoid the update conflict. Since the local computation only needs to process the model obtained during the rotation without considering the parallel model updates from
other workers, the code of a parallel machine learning algorithm can be modularized as a process of performing computation and rotating model partitions.</p>

<p>We adopt <code>Model Rotation</code> to parallel CGS LDA algorithm. The data flow and algorithm are show as follows:</p>

<p><img src="https://dsc-spidal.github.io/harp/img/model-rotation.png" width="100%" ></p>

<h1 id="performance">Performance</h1>

<p><img src="https://dsc-spidal.github.io/harp/img/2-1-5.png" width="50%"></p>

<p><img src="https://dsc-spidal.github.io/harp/img/2-1-3.png" alt="Overview-3" /></p>

<p>Experiments are conducted on a 128-node Intel Haswell cluster at Indiana University. Among the 32 of the nodes, each have two 18-core Xeon E5-2699 v3 processors (36 cores in total), and 96 nodes each have two 12-core Xeon E5- 2670 v3 processors (24 cores in total). All the nodes have 128 GB memory and are connected by QDR InfiniBand. For our tests, JVM memory is set to &ldquo;-Xmx120000m -Xms120000m&rdquo;, and IPoIB is used for communication.</p>

<p>We use one big dataset which is generated from &ldquo;ClueWeb09&rdquo; to test LDA both on Harp and Petuum.</p>

<p>Through examining the model likelihood achieved by the training time, the results show that Harp consistently outperforms Petuum. We test Harp CGS and Petuum on &ldquo;clueweb1&rdquo; with 30 nodes × 30 threads and 60 nodes × 20 threads two configurations. Both results show that Harp CGS converges faster than Petuum. Concerning the convergence speed on the same dataset with different configurations, we observe that the fewer the number of cores used and the more computation per core, the faster Harp runs compare to Petuum. When the scale goes up, the difference of the convergence speed reduces. With 30 nodes × 30 threads Xeon E5-2699 v3 nodes, Harp is 45% faster than Petuum while with 60 nodes × 20 threads Xeon E5-2670 v3 nodes, Harp is 18% faster than Petuum when the model likelihood converges to −1.37 × 10^11.</p>

<h1 id="run-lda-example">Run LDA example</h1>

<h2 id="data">Data</h2>

<p>You can download public data and transfer to the data format required by sgd and ccd application. Here are some <a href="https://dsc-spidal.github.io/harp/docs/applications/dataset-lda">datasets</a> for your reference.</p>

<h3 id="data-format">Data Format</h3>

<p>The format for the data should be a list of <code>doc-name  wordid1 wordid2 ...&gt;</code>. For example,</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>doc1   <span style="color: #ae81ff">63</span> <span style="color: #ae81ff">264</span> <span style="color: #ae81ff">374</span> <span style="color: #ae81ff">4695</span> <span style="color: #ae81ff">5441</span>  <span style="color: #ae81ff">1200</span> <span style="color: #ae81ff">1200</span> <span style="color: #ae81ff">25529</span>  1707
doc2   <span style="color: #ae81ff">545</span> <span style="color: #ae81ff">1939</span> <span style="color: #ae81ff">206863</span> <span style="color: #ae81ff">773279</span> 773279
...
</pre></div>

<h2 id="usage">Usage</h2>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>hadoop jar harp-java-0.1.0.jar edu.iu.lda.LDALauncher &lt;doc dir&gt; &lt;num of topics&gt; &lt;alpha&gt; &lt;beta&gt; &lt;num of iterations&gt; &lt;min training percentage&gt; &lt;max training percentage&gt; &lt;num of mappers&gt; &lt;num of threads per worker&gt; &lt;schedule ratio&gt; &lt;memory <span style="color: #f92672">(</span>MB<span style="color: #f92672">)</span>&gt; &lt;work dir&gt; &lt;print model&gt;

	&lt;doc dir&gt;			<span style="color: #f8f8f2">;</span> input directory
	&lt;num of topics&gt;		<span style="color: #f8f8f2">;</span> K
	&lt;alpha&gt; &lt;beta&gt;		<span style="color: #f8f8f2">;</span> suggested setting as <span style="color: #f8f8f2">alpha</span> <span style="color: #f92672">=</span> 50/K, <span style="color: #f8f8f2">beta</span> <span style="color: #f92672">=</span> 0.01
	&lt;num of iterations&gt; <span style="color: #f8f8f2">;</span> iteration number
	&lt;min training percentage&gt;	<span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">set</span> the min/max training percentage to utilize timer control of synchronization
	&lt;max training percentage&gt;	<span style="color: #f8f8f2">;</span> 100,100 will <span style="color: #f8f8f2">set</span> timer off, 40, <span style="color: #ae81ff">90</span> will works fine with timer on
	&lt;num of mappers&gt;			<span style="color: #f8f8f2">;</span> 
	&lt;num of threads per worker&gt; <span style="color: #f8f8f2">;</span>
	&lt;schedule ratio&gt;	<span style="color: #f8f8f2">;</span> blocks partition ratio <span style="color: #66d9ef">for</span> dynamic scheduler, <span style="color: #ae81ff">2</span> means spliting to 2xThread# X 2xMapper# blocks
	&lt;memory <span style="color: #f92672">(</span>MB<span style="color: #f92672">)</span>&gt;		<span style="color: #f8f8f2">;</span> memory setting <span style="color: #66d9ef">for</span> JVM
	&lt;work dir&gt;			<span style="color: #f8f8f2">;</span> working directory, model saved in this directory
	&lt;print model&gt;		<span style="color: #f8f8f2">;</span> True/False, save model W <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">set</span> to Ture
</pre></div>

<h3 id="example">Example</h3>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">#put data onto hdfs</span>
cp <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/datasets/tutorial/nytimes-30k/nytimes-30K.mrlda .
mkdir data
<span style="color: #f8f8f2">cd</span> data/
split -l <span style="color: #ae81ff">1000</span> <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/datasets/tutorial/nytimes-30k/nytimes-30K.mrlda
<span style="color: #f8f8f2">cd</span> ..
hadoop fs -mkdir -p /harp-test/cgs/
hadoop fs -put data /harp-test/cgs/

<span style="color: #75715e">#run lda training</span>
hadoop jar harp-java-0.1.0.jar edu.iu.lda.LDALauncher /harp-test/cgs/data <span style="color: #ae81ff">100</span> 0.5 0.01 <span style="color: #ae81ff">100</span> <span style="color: #ae81ff">100</span> <span style="color: #ae81ff">100</span> <span style="color: #ae81ff">10</span> <span style="color: #ae81ff">16</span> <span style="color: #ae81ff">2</span> <span style="color: #ae81ff">10000</span> /harp-test/cgsout True
</pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>