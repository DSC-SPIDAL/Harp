<<<<<<< HEAD
<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18.1" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="Harp-DAAL-SGD"><meta property="og:url" content="/docs/harpdaal/Example/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Harp-DAAL-SGD</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://github.com/DSC-SPIDAL/harp/">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="quick-start" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-quick-start" aria-labelledby="quick-start"><i class="fa fa-caret-right"></i>Quick Start</a></h4></section><div id="collapse-quick-start" class="panel-collapse collapse" aria-labelledby="quick-start"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation</a></li></ul></div></div></div><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li></ul></div></div></div><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/mf">Matrix Factorization</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Harp-DAAL</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Example">Example</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/contributors">Contributors</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Harp-DAAL-SGD</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">
=======
<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="Harp-DAAL-SGD"><meta property="og:url" content="/docs/harpdaal/Example/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Harp-DAAL-SGD</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://github.com/DSC-SPIDAL/harp/">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="quick-start" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-quick-start" aria-labelledby="quick-start"><i class="fa fa-caret-right"></i>Quick Start</a></h4></section><div id="collapse-quick-start" class="panel-collapse collapse" aria-labelledby="quick-start"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation</a></li></ul></div></div></div><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li></ul></div></div></div><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/mf">Matrix Factorization</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Harp-DAAL</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Example">Example</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/contributors">Contributors</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Harp-DAAL-SGD</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">
>>>>>>> 28fdb0e2f577765e517f679af115bed18f43f358

<h2 id="matrix-factorization-based-on-stochastic-gradient-descent-mf-sgd">Matrix Factorization based on Stochastic Gradient Descent (MF-SGD)</h2>

<p>Matrix Factorization based on Stochastic Gradient Descent (MF-SGD for short) is an algorithm widely used in recommender systems.
It aims to factorize a sparse matrix into two low-rank matrices named mode W and model H as follows.</p>

<p><img src="https://dsc-spidal.github.io/harp/img/harpdaal/7-2-1.png" width="10%" height="10%"><br></p>

<p>The rating Matrix V includes both training data and test data. A learning algorithm uses the training data to update matrices W and H.
For instance, a standard SGD procedure will update the model W and H
while iterating over each training data point, i.e., an entry in matrix V in the following formula.</p>

<p><img src="https://dsc-spidal.github.io/harp/img/harpdaal/7-2-2.png" width="25%" height="25%"><br></p>

<p><img src="https://dsc-spidal.github.io/harp/img/harpdaal/7-2-3.png" width="40%" height="40%"><br></p>

<p><img src="https://dsc-spidal.github.io/harp/img/harpdaal/7-2-4.png" width="40%" height="40%"><br></p>

<p>After the training process, the test data points in matrix V could be used to verify the effectiveness of the training matrix by computing the RMSE values of
the difference</p>

<p><img src="https://dsc-spidal.github.io/harp/img/harpdaal/7-2-2.png" width="25%" height="25%"><br></p>

<h2 id="implementation-of-sgd-within-harp-daal-framework">Implementation of SGD within Harp-DAAL Framework</h2>

<p>The main body of Harp-DAAL-SGD is the <em>mapCollective</em> function of class <em>SGDDaalCollectiveMapper</em>.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">protected</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">mapCollective</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">KeyValReader</span> <span style="color: #f8f8f2">reader</span><span style="color: #f92672">,</span> 
            <span style="color: #f8f8f2">Context</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">InterruptedException</span> <span style="color: #f92672">{</span>

            <span style="color: #f8f8f2">LinkedList</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">vFiles</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">getVFiles</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">reader</span><span style="color: #f92672">);</span>

            <span style="color: #66d9ef">try</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">runSGD</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">vFiles</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getConfiguration</span><span style="color: #f92672">(),</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span> <span style="color: #66d9ef">catch</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">Exception</span> <span style="color: #f8f8f2">e</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">LOG</span><span style="color: #f92672">.</span><span style="color: #a6e22e">error</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Fail to run SGD.&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">e</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>It first uses the function <em>getVFiles</em> to read in HDFS files, then it runs the <em>runSGD</em> to finish the iterative training process. Besides the <em>vFiles</em>, <em>runSGD</em> will also
take in the configurations of all the parameters needed by the training and testing process. The following list includes some of the important parameters.</p>

<ul>
<li>r: the feature dimension of model data</li>
<li>lambda: the lambda parameter in the formula of updating model W and H</li>
<li>epsilon: the learning rate in the formula of updating model W and H</li>
<li>numIterations: the number of iterations in the training process</li>
<li>numThreads: the number of threads used in Java multi-threading programming and TBB</li>
<li>numModelSlices: the number of pipelines in model rotation</li>
</ul>

<p>The function <em>runSGD</em> contains several steps as follows:</p>

<h3 id="loading-training-and-testing-datasets">Loading Training and Testing Datasets</h3>

<p>First invokes class <em>SGDUtil</em> to load datasets</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//load the train dataset</span>
<span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">VRowCol</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">vRowMap</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SGDUtil</span><span style="color: #f92672">.</span><span style="color: #a6e22e">loadVWMap</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">vFilePaths</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">configuration</span><span style="color: #f92672">);</span>

<span style="color: #75715e">//load the test dataset</span>
<span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">VRowCol</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">testVRowMap</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SGDUtil</span><span style="color: #f92672">.</span><span style="color: #a6e22e">loadTestVWMap</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">testFilePath</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">configuration</span><span style="color: #f92672">);</span>
</pre></div>

<h3 id="regrouping-datasets-and-creating-w-matrix">Regrouping Datasets and Creating W matrix</h3>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//wMap is the W matrix shared by both of training and testing dataset</span>
<span style="color: #66d9ef">final</span> <span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">double</span><span style="color: #f92672">[]&gt;</span> <span style="color: #f8f8f2">wMap</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">&lt;&gt;();</span>

<span style="color: #75715e">//vWHMap contains the training points</span>
<span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">VRowCol</span><span style="color: #f92672">&gt;[]</span> <span style="color: #f8f8f2">vWHMap</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">numRowSplits</span><span style="color: #f92672">];</span>

<span style="color: #75715e">//testWHMap contains the testing points</span>
<span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">VRowCol</span><span style="color: #f92672">&gt;[]</span> <span style="color: #f8f8f2">testWHMap</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">numRowSplits</span><span style="color: #f92672">];</span>

<span style="color: #66d9ef">final</span> <span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">workerNumV</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">createVWHMapAndWModel</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">vWHMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vRowMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">oneOverSqrtR</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">random</span><span style="color: #f92672">);</span>
<span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">totalNumTestV</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">createTestWHMap</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">testWHMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">testVRowMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">oneOverSqrtR</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">random</span><span style="color: #f92672">);</span>
</pre></div>

<p>Both of training data points and testing data points are first regrouped by rows through Harp&rsquo;s function
between all the collectiveMappers.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">regroup</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;sgd&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;regroup-vw&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vSetTable</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Partitioner</span><span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getNumWorkers</span><span style="color: #f92672">()));</span>
</pre></div>

<p>and then they are divided into <em>numRowSplits</em> slices, and within <em>createVWHMapAndWModel</em>,
<em>numThreads</em> of Java threads will process the data points and generate the W matrix in parallel.</p>

<h3 id="loading-data-into-daal-s-data-structure">Loading Data into DAAL&rsquo;s Data Structure</h3>

<p>Firstly, we load W matrix from Harp&rsquo;s data structure to DAAL&rsquo;s data structure</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//an index hashmap for W model data in DAAL</span>
<span style="color: #66d9ef">final</span> <span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">Integer</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">wMap_index</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">&lt;&gt;();</span>
<span style="color: #75715e">//create W Model data in DAAL as a homogenNumericTable</span>
<span style="color: #f8f8f2">NumericTable</span> <span style="color: #f8f8f2">wMap_daal</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">HomogenNumericTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">daal_Context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Double</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_size</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">NumericTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">AllocationFlag</span><span style="color: #f92672">.</span><span style="color: #a6e22e">DoAllocate</span><span style="color: #f92672">);</span>
<span style="color: #75715e">//create the converter between Harp and DAAL</span>
<span style="color: #f8f8f2">HomogenTableHarpMap</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">double</span><span style="color: #f92672">[]&gt;</span> <span style="color: #f8f8f2">convert_wTable</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">HomogenTableHarpMap</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">double</span><span style="color: #f92672">[]&gt;(</span><span style="color: #f8f8f2">wMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_index</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_daal</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_size</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">);</span>
<span style="color: #75715e">//convert wMap from Harp side to DAAL side </span>
<span style="color: #f8f8f2">convert_wTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">HarpToDaalDouble</span><span style="color: #f92672">();</span>
</pre></div>

<p>Secondly, we create the H matrix and the rotator used in the model-rotation communication paradigm.
The H matrix is divided into <em>numModelSlices</em> slices, each slice serves as a pipeline for computation and communication.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">// Create H model</span>
<span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;[]</span> <span style="color: #f8f8f2">hTableMap</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">numModelSlices</span><span style="color: #f92672">];</span>
<span style="color: #f8f8f2">createHModel</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">hTableMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numModelSlices</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vWHMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">oneOverSqrtR</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">random</span><span style="color: #f92672">);</span>
<span style="color: #75715e">//create the rotator</span>
<span style="color: #f8f8f2">RotatorDaal</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">double</span><span style="color: #f92672">[],</span> <span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">rotator</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">RotatorDaal</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #f8f8f2">hTableMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">20</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;sgd&quot;</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">rotator</span><span style="color: #f92672">.</span><span style="color: #a6e22e">start</span><span style="color: #f92672">();</span>
</pre></div>

<p>Thirdly, we create an instance of computing mf_sgd within DAAL and set up the parameters</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//create DAAL algorithm object, using distributed version of DAAL-MF-SGD  </span>
<span style="color: #f8f8f2">Distri</span> <span style="color: #f8f8f2">sgdAlgorithm</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Distri</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">daal_Context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Double</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Method</span><span style="color: #f92672">.</span><span style="color: #a6e22e">defaultSGD</span><span style="color: #f92672">);</span>
<span style="color: #75715e">//first set up W Model, for all the iterations</span>
<span style="color: #f8f8f2">PartialResult</span> <span style="color: #f8f8f2">model_data</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">PartialResult</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">daal_Context</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">sgdAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setPartialResult</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">model_data</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">model_data</span><span style="color: #f92672">.</span><span style="color: #a6e22e">set</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">PartialResultId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">presWMat</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_daal</span><span style="color: #f92672">);</span>
</pre></div>

<p>Finally, we pre-loading the training and testing datasets from Harp/Java side into DAAL/C++ side</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">totalNumTestV</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">loadDataDaal</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">numWorkers</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numRowSplits</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">rotator</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vWHMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">testWHMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">hTableMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_index</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">taskMap_daal</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">train_data_wPos</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">train_data_hPos</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">train_data_val</span><span style="color: #f92672">,</span> 
                <span style="color: #f8f8f2">test_data_wPos</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">test_data_hPos</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">test_data_val</span><span style="color: #f92672">);</span>
</pre></div>

<h3 id="starting-the-iterative-training-process-and-the-testing-process">Starting the Iterative Training Process and the Testing Process</h3>

<p>First, we compute the RMSE value before the training process.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//computeRMSE before iteration</span>
<span style="color: #f8f8f2">printRMSEbyDAAL</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">sgdAlgorithm</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">model_data</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">test_data_wPos</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">test_data_hPos</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">test_data_val</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">rotator</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numWorkers</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">totalNumTestV</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_size</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">configuration</span><span style="color: #f92672">);</span>
</pre></div>

<p>The iterative process loops over all the iterations, rotated workers, and the pipelines.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;=</span> <span style="color: #f8f8f2">numIterations</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>

    <span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">j</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">j</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">numWorkers</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">j</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>

        <span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">k</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">k</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">numModelSlices</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">k</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>

            <span style="color: #75715e">//get the h matrix from the rotator</span>
            <span style="color: #f8f8f2">NumericTable</span> <span style="color: #f8f8f2">hTableMap_daal</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">rotator</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getDaal_Table</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">k</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">model_data</span><span style="color: #f92672">.</span><span style="color: #a6e22e">set</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">PartialResultId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">presHMat</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">hTableMap_daal</span><span style="color: #f92672">);</span>

            <span style="color: #75715e">//get the pre-loaded training dataset</span>
            <span style="color: #f8f8f2">NumericTable</span> <span style="color: #f8f8f2">daal_task_wPos</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">train_data_wPos</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">slice_index</span><span style="color: #f92672">);</span> 
            <span style="color: #f8f8f2">NumericTable</span> <span style="color: #f8f8f2">daal_task_hPos</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">train_data_hPos</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">slice_index</span><span style="color: #f92672">);</span> 
            <span style="color: #f8f8f2">NumericTable</span> <span style="color: #f8f8f2">daal_task_val</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">train_data_val</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">slice_index</span><span style="color: #f92672">);</span> 

            <span style="color: #75715e">//set up the datasets within the DAAL&#39;s instance</span>
            <span style="color: #f8f8f2">sgdAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">set</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">InputId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">dataWPos</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">daal_task_wPos</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">sgdAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">set</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">InputId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">dataHPos</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">daal_task_hPos</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">sgdAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">set</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">InputId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">dataVal</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">daal_task_val</span><span style="color: #f92672">);</span>

            <span style="color: #75715e">//set up the parameters for MF-DAAL-SGD</span>
            <span style="color: #f8f8f2">sgdAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">parameter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">set</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">epsilon</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">lambda</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_size</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">hPartitionMapSize</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">);</span>

            <span style="color: #75715e">//computation </span>
            <span style="color: #f8f8f2">sgdAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compute</span><span style="color: #f92672">();</span>

            <span style="color: #75715e">//trigger the rotator after one time of computation</span>
            <span style="color: #f8f8f2">rotator</span><span style="color: #f92672">.</span><span style="color: #a6e22e">rotate</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">k</span><span style="color: #f92672">);</span>

        <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<h2 id="task-parallel-programming">Task Parallel Programming</h2>

<p>We chose a taskflow based programming model in Harp-DAAL-SGD application. Within this model, a model matrix W is initially
released into the DAAL&rsquo;s data structures, which is a <em>HomogenNumericTable</em>, and stay within DAAL till the end of program&rsquo;s life cycle.
The other model data, matrix H, is loaded into DAAL&rsquo;s data structure after every occurrence of the model rotation.
The training model data, V, is stored in Harp&rsquo;s side.
Each training point is represented by a Task object. Each $Task$ object consists of three fields:</p>

<ul>
<li>Position of the associated row in matrix W</li>
<li>Position of the associated column in matrix H</li>
<li>The value of the training data V</li>
</ul>

<p>The taskflow is organized on the Harp side, which then delivers the tasks into DAAL&rsquo;s computation kernels. The DAAL sgd kernel will get the corresponding row and column from the W and H matrices stored in its
data structure, and complete the computation and updating work.</p>

<h2 id="tbb-versus-java-multithreading">TBB versus Java Multithreading</h2>

<p>In the original Bingjing&rsquo;s SGD implementation, It uses raw Java threads to accomplish the tasks in parallel.
Accordingly, it implements its own scheduler and the policy, the timer and the pipeline. In contrast, our Harp-DAAL-SGD uses Intel&rsquo;s Threading Building Block
(TBB) to compute the SGD tasks in parallel. TBB provides the users of many parallel algorithm templates, and we use the <em>parallel_for</em> template to achieve the computation within SGD.</p>

<p>Compared to the raw Java threads based parallel computing, the use of TBB has the following benefits:</p>

<ul>
<li>The users only take care of the parallel tasks instead of the raw threads.</li>
<li>For each TBB thread, the C++ codes have more parallelism from the optimization of compilers.</li>
<li>TBB&rsquo;s scheduler will probably enjoy a better load balance than that of user&rsquo;s own scheduler.</li>
</ul>

<p>Although DAAL with TBB could give us faster computation of operations such as vector inner product and matrix-vector multiplication,
it still has some additional overhead within the Harp environment. DAAL has a different
Data structure than Harp, so we need to convert data from Harp to DAAL, from Java side to C++ side.
If the computation time is not dominant in the total execution time, which is related to the dimension of W and H, then the
additional overhead of using DAAL will make the codes less competitive than the original pure Java based implementation.
Once the dimension rises, the computation becomes more intensive, and the advantages of DAAL and TBB will
appear and outperform the original implementation on Java threads.</p>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>