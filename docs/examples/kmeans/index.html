<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="K-Means"><meta property="og:url" content="/docs/examples/kmeans/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - K-Means</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://github.com/DSC-SPIDAL/harp/">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="quick-start" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-quick-start" aria-labelledby="quick-start"><i class="fa fa-caret-right"></i>Quick Start</a></h4></section><div id="collapse-quick-start" class="panel-collapse collapse" aria-labelledby="quick-start"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation</a></li></ul></div></div></div><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li></ul></div></div></div><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/sdg">Stochastic Gradient Descent</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/ccd">Cyclic Coordinate Descent</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Harp-DAAL</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Example">Example</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/contributors">Contributors</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>K-Means</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p>This section describes how to implement the K-means algorithm using Harp.</p>

<h1 id="understanding-k-means">Understanding K-Means</h1>

<p>K-Means is a very powerful and easily understood clustering algorithm. The aim of the algorithm is to divide a given set of points into “K” partitions. “K” needs to be specified by the user. In order to understand K-Means, first you need to understand the proceeding concepts and their meaning.</p>

<ol>
<li><p><code>Centroids</code>:
Centroids can be defined as the center of each cluster. If we are performing clustering with k=3, we will have 3 centroids. To perform K-Means clustering, the users needs to provide the initial set of centroids.</p></li>

<li><p><code>Distance</code>:
In order to group data points as close together or as far-apart we need to define a distance between two given data points. In K-Means clustering distance is normally calculated as the Euclidean Distance between two data points.</p></li>
</ol>

<p>The K-Means algorithm simply repeats the following set of steps until there is no change in the partition assignments, in that it has clarified which data point is assigned to which partition.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">Choose</span> <span style="color: #f8f8f2">K</span> <span style="color: #f8f8f2">points</span> <span style="color: #f8f8f2">as</span> <span style="color: #f8f8f2">the</span> <span style="color: #f8f8f2">initial</span> <span style="color: #f8f8f2">set</span> <span style="color: #f8f8f2">of</span> <span style="color: #f8f8f2">centroids</span><span style="color: #f92672">.</span>
<span style="color: #f8f8f2">Assign</span> <span style="color: #f8f8f2">each</span> <span style="color: #f8f8f2">data</span> <span style="color: #f8f8f2">point</span> <span style="color: #f8f8f2">in</span> <span style="color: #f8f8f2">the</span> <span style="color: #f8f8f2">data</span> <span style="color: #f8f8f2">set</span> <span style="color: #f8f8f2">to</span> <span style="color: #f8f8f2">the</span> <span style="color: #f8f8f2">closest</span> <span style="color: #a6e22e">centroid</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">this</span> <span style="color: #f8f8f2">is</span> <span style="color: #f8f8f2">done</span> <span style="color: #f8f8f2">by</span> <span style="color: #f8f8f2">calculating</span> <span style="color: #f8f8f2">the</span> <span style="color: #f8f8f2">distance</span> <span style="color: #f8f8f2">between</span> <span style="color: #f8f8f2">the</span> <span style="color: #f8f8f2">data</span> <span style="color: #f8f8f2">point</span> <span style="color: #f8f8f2">and</span> <span style="color: #f8f8f2">each</span> <span style="color: #f8f8f2">centroid</span><span style="color: #f92672">).</span>
<span style="color: #f8f8f2">Calculate</span> <span style="color: #f8f8f2">the</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">centroids</span> <span style="color: #f8f8f2">based</span> <span style="color: #f8f8f2">on</span> <span style="color: #f8f8f2">the</span> <span style="color: #f8f8f2">clusters</span> <span style="color: #f8f8f2">that</span> <span style="color: #f8f8f2">were</span> <span style="color: #f8f8f2">generated</span> <span style="color: #f8f8f2">in</span> <span style="color: #f8f8f2">step</span> <span style="color: #ae81ff">2.</span> <span style="color: #f8f8f2">Normally</span> <span style="color: #66d9ef">this</span> <span style="color: #f8f8f2">is</span> <span style="color: #f8f8f2">done</span> <span style="color: #f8f8f2">by</span> <span style="color: #f8f8f2">calculating</span> <span style="color: #f8f8f2">the</span> <span style="color: #f8f8f2">mean</span> <span style="color: #f8f8f2">of</span> <span style="color: #f8f8f2">each</span> <span style="color: #f8f8f2">cluster</span><span style="color: #f92672">.</span>
<span style="color: #f8f8f2">Repeat</span> <span style="color: #f8f8f2">steps</span> <span style="color: #ae81ff">2</span> <span style="color: #f8f8f2">and</span> <span style="color: #ae81ff">3</span> <span style="color: #f8f8f2">until</span> <span style="color: #f8f8f2">data</span> <span style="color: #f8f8f2">points</span> <span style="color: #66d9ef">do</span> <span style="color: #f8f8f2">not</span> <span style="color: #f8f8f2">change</span> <span style="color: #f8f8f2">cluster</span> <span style="color: #f8f8f2">assignments</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">meaning</span> <span style="color: #f8f8f2">their</span> <span style="color: #f8f8f2">centroids</span> <span style="color: #f8f8f2">are</span> <span style="color: #f8f8f2">set</span><span style="color: #f92672">.</span>
</pre></div>

<h1 id="pseduo-code-and-java-code">Pseduo Code and Java Code</h1>

<h2 id="the-main-method">The Main Method</h2>

<p>The tasks of the main class is to configure and run the job iteratively.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">generate</span> <span style="color: #f8f8f2">N</span> <span style="color: #f8f8f2">data</span> <span style="color: #a6e22e">points</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">D</span> <span style="color: #f8f8f2">dimensions</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">write</span> <span style="color: #f8f8f2">to</span> <span style="color: #f8f8f2">HDFS</span>
<span style="color: #f8f8f2">generate</span> <span style="color: #f8f8f2">M</span> <span style="color: #f8f8f2">centroids</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">write</span> <span style="color: #f8f8f2">to</span> <span style="color: #f8f8f2">HDFS</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">iterations</span><span style="color: #f92672">{</span>
    <span style="color: #f8f8f2">configure</span> <span style="color: #f8f8f2">a</span> <span style="color: #f8f8f2">job</span>
    <span style="color: #f8f8f2">launch</span> <span style="color: #f8f8f2">the</span> <span style="color: #f8f8f2">job</span>
<span style="color: #f92672">}</span>
</pre></div>

<h2 id="the-mapcollective-function">The mapCollective function</h2>

<p>This is the definition of map-collective task. It reads data from context and then call runKmeans function to actually run kmeans Mapper task.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">protected</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">mapCollective</span><span style="color: #f92672">(</span> <span style="color: #f8f8f2">KeyValReader</span> <span style="color: #f8f8f2">reader</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Context</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">InterruptedException</span> <span style="color: #f92672">{</span>
		<span style="color: #f8f8f2">LOG</span><span style="color: #f92672">.</span><span style="color: #a6e22e">info</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Start collective mapper.&quot;</span><span style="color: #f92672">);</span>
	    <span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">startTime</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">currentTimeMillis</span><span style="color: #f92672">();</span>
	    <span style="color: #f8f8f2">List</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">pointFiles</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ArrayList</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">&gt;();</span>
	    <span style="color: #66d9ef">while</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">reader</span><span style="color: #f92672">.</span><span style="color: #a6e22e">nextKeyValue</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
	    	<span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">reader</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getCurrentKey</span><span style="color: #f92672">();</span>
	    	<span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">value</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">reader</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getCurrentValue</span><span style="color: #f92672">();</span>
	    	<span style="color: #f8f8f2">LOG</span><span style="color: #f92672">.</span><span style="color: #a6e22e">info</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Key: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">key</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;, Value: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">);</span>
	    	<span style="color: #f8f8f2">pointFiles</span><span style="color: #f92672">.</span><span style="color: #a6e22e">add</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">value</span><span style="color: #f92672">);</span>
	    <span style="color: #f92672">}</span>
	    <span style="color: #f8f8f2">Configuration</span> <span style="color: #f8f8f2">conf</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getConfiguration</span><span style="color: #f92672">();</span>
	    <span style="color: #f8f8f2">runKmeans</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">pointFiles</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">);</span>
	    <span style="color: #f8f8f2">LOG</span><span style="color: #f92672">.</span><span style="color: #a6e22e">info</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Total iterations in master view: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">currentTimeMillis</span><span style="color: #f92672">()</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">startTime</span><span style="color: #f92672">));</span>
	  <span style="color: #f92672">}</span>
</pre></div>

<h2 id="step-3-map-collective">Step 3 &mdash; Map Collective</h2>

<p>Harp provides several collective communication operations. Here are some examples provided to show how to apply these collective communication methods to K-Means.</p>

<p><ul class="nav nav-pills">
    <li class="active"><a data-toggle="pill" href="#allreduce">Allreduce</a></li>
    <li><a data-toggle="pill" href="#broadcast-reduce">Broadcast-Reduce</a></li>
    <li><a data-toggle="pill" href="#push-pull">Push-Pull</a></li>
    <li><a data-toggle="pill" href="#regroup-allgather">Regroup-Allgather</a></li>
  </ul></p>

<p><div class="tab-content">
    <div id="allreduce" class="tab-pane fade in active">
      <h3>HOME</h3>
      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
    </div>
    <div id="broadcast-reduce" class="tab-pane fade">
      <h3>Menu 1</h3>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
    </div>
    <div id="push-pull" class="tab-pane fade">
      <h3>Menu 2</h3>
      <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
    </div>
    <div id="regroup-allgather" class="tab-pane fade">
      <h3>Menu 3</h3>
      <p>Eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
    </div>
  </div></p>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>