<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.16-DEV" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content=""><meta property="og:site_name" content="Harp-DAAL-Cov"><meta property="og:url" content=""><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Harp-DAAL-Cov</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png" width="76%"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://github.com/DSC-SPIDAL/harp/">GitHub</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/survey">Feedback</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="quick-start" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-quick-start" aria-labelledby="quick-start"><i class="fa fa-caret-right"></i>Quick Start</a></h4></section><div id="collapse-quick-start" class="panel-collapse collapse" aria-labelledby="quick-start"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation (single)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started-cluster">Harp Installation (cluster)</a></li></ul></div></div></div><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/rf">Random Forests</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/nn">Neural Network</a></li></ul></div></div></div><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/mf">Matrix Factorization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/sahad">Sub-graph Counting</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/kmeans">K-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/mfsgd">Matrix Factorization (SGD)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/als">Recommender System (ALS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/svd">Singular Value Decomposition (SVD)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/pca">Principal Component Analysis (PCA)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/nn">Neural Network</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/qr">QR Decomposition (QR)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/covariance">Covariance</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/moments">Low Order Moments</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/naive_bayes">Naive Bayes</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/linear_regression">Linear Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/ridge_regression">Ridge Regression</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/contributors">Contributors</a></li></ul></div></div></div><div class="panel panel-default"><section id="user-feedback" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-user-feedback" aria-labelledby="user-feedback"><i class="fa fa-caret-right"></i>User Feedback</a></h4></section><div id="collapse-user-feedback" class="panel-collapse collapse" aria-labelledby="user-feedback"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/survey">Online Survey</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Harp-DAAL-Cov</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<h2 id="overview:356f582a1f3b0ca144998525c9d17238">Overview</h2>

<p>Covariance measures the extent to which variables &ldquo;fluctuate together&rdquo; (that is, co-vary). The correlation is the covariance normalized to be between -1 and +1. A positive correlation indicates the extent to which variables increase or decrease simultaneously. A negative correlation indicates the extent to which one variable increases while the other one decreases. Values close to +1 and -1 indicate a high degree of linear dependence between variables.</p>

<h2 id="implementation-of-harp-daal-cov:356f582a1f3b0ca144998525c9d17238">Implementation of Harp-DAAL-Cov</h2>

<p>Harp-DAAL-Cov is built upon the original DAAL distributed implementation of the algorithm using the Harp interface libraries for the collective-communication among the data nodes.
The implementation of Cov in our Harp-DAAL consists of two levels. At the top Level, using Harp’s reduce operation to communication model data among mappers. At the bottom Level, using DAAL’s  kernels to conduct local computations.</p>

<h3 id="brief-background:356f582a1f3b0ca144998525c9d17238">Brief background</h3>

<ul>
<li><p>There are primarily three kinds of nodes involved with the implementation.</p></li>

<li><p>name node</p></li>

<li><p>data node</p>

<ul>
<li>master node</li>
<li>slave node</li>
</ul></li>

<li><p>The Java language services provided by Intel as a wrapper to their C++ code.</p></li>

<li><p>The description of the intel daal&rsquo;s JAVA API used can be found <a href="https://software.intel.com/sites/products/documentation/doclib/daal/daal-user-and-reference-guides/hh_goto.htm?index.htm#daal_java_api/group__covariance.htm">here</a></p></li>
</ul>

<h3 id="code-walk-through:356f582a1f3b0ca144998525c9d17238">Code Walk-Through</h3>

<p>The actual implemented code can be found <a href="https://github.com/DSC-SPIDAL/harp/tree/master/harp-daal-app/src/main/java/edu/iu/daal_cov">here</a>. The MapCollective function is defined <a href="https://github.com/DSC-SPIDAL/harp/blob/master/harp-daal-app/src/main/java/edu/iu/daal_cov/COVDaalCollectiveMapper.java">here</a>.</p>

<h4 id="step-1-on-data-nodes:356f582a1f3b0ca144998525c9d17238">Step 1 (on data nodes)</h4>

<p>The first step involves reading the files from the hdfs filesystem after splitting files between each mapper. Splitting is done by MultipleFileInputFormat class defined <a href="https://github.com/DSC-SPIDAL/harp/blob/master/harp-daal-app/src/main/java/edu/iu/fileformat/MultiFileInputFormat.java">here</a>.
Data is converted into array which is eventually converted into the daal <a href="https://software.intel.com/en-us/node/564579"><em>Numeric Table</em></a> datastructure.  In this example the files have been stored on the hdfs. The files have to be read in the daal table format as the local computations are performed by the daal libraries.
Getting array from csv file -</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>  <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">double</span><span style="color: #f92672">[]</span> <span style="color: #a6e22e">loadPoints</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">file</span><span style="color: #f92672">,</span>
    <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">pointsPerFile</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">cenVecSize</span><span style="color: #f92672">,</span>
    <span style="color: #f8f8f2">Configuration</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">Exception</span> <span style="color: #f92672">{</span>
    <span style="color: #66d9ef">double</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">points</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #66d9ef">double</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">pointsPerFile</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">cenVecSize</span><span style="color: #f92672">];</span>
    <span style="color: #f8f8f2">Path</span> <span style="color: #f8f8f2">pointFilePath</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Path</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">file</span><span style="color: #f92672">);</span>
    <span style="color: #f8f8f2">FileSystem</span> <span style="color: #f8f8f2">fs</span> <span style="color: #f92672">=</span>
      <span style="color: #f8f8f2">pointFilePath</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getFileSystem</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
    <span style="color: #f8f8f2">FSDataInputStream</span> <span style="color: #f8f8f2">in</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fs</span><span style="color: #f92672">.</span><span style="color: #a6e22e">open</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">pointFilePath</span><span style="color: #f92672">);</span>
    <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">k</span> <span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>
    <span style="color: #66d9ef">try</span><span style="color: #f92672">{</span>
      <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">pointsPerFile</span><span style="color: #f92672">;</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">++){</span>
        <span style="color: #f8f8f2">String</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">in</span><span style="color: #f92672">.</span><span style="color: #a6e22e">readLine</span><span style="color: #f92672">().</span><span style="color: #a6e22e">split</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;,&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">j</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">j</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">cenVecSize</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">j</span><span style="color: #f92672">++){</span>
          <span style="color: #f8f8f2">points</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">k</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Double</span><span style="color: #f92672">.</span><span style="color: #a6e22e">parseDouble</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">line</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">]);</span>
          <span style="color: #f8f8f2">k</span><span style="color: #f92672">++;</span>
        <span style="color: #f92672">}</span>
      <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span> <span style="color: #66d9ef">finally</span><span style="color: #f92672">{</span>
      <span style="color: #f8f8f2">in</span><span style="color: #f92672">.</span><span style="color: #a6e22e">close</span><span style="color: #f92672">();</span>
    <span style="color: #f92672">}</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">points</span><span style="color: #f92672">;</span>
  <span style="color: #f92672">}</span>
</pre></div>

<p>Converting array to Numeric Table -</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">List</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">double</span><span style="color: #f92672">[]&gt;</span> <span style="color: #f8f8f2">pointArrays</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">COVUtil</span><span style="color: #f92672">.</span><span style="color: #a6e22e">loadPoints</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainingDataFiles</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">pointsPerFile</span><span style="color: #f92672">,</span>
        <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">);</span>
      <span style="color: #f8f8f2">ts2</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">currentTimeMillis</span><span style="color: #f92672">();</span>
      <span style="color: #f8f8f2">load_time</span> <span style="color: #f92672">+=</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">ts2</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">ts1</span><span style="color: #f92672">);</span>

     <span style="color: #75715e">// converting data to Numeric Table</span>
      <span style="color: #f8f8f2">ts1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">currentTimeMillis</span><span style="color: #f92672">();</span>
      <span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">nFeature</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">;</span>
      <span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">nLabel</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">;</span>
      <span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">totalLengthFeature</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>

      <span style="color: #66d9ef">long</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">array_startP_feature</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #66d9ef">long</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">pointArrays</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span><span style="color: #f92672">()];</span>
      <span style="color: #66d9ef">double</span><span style="color: #f92672">[][]</span> <span style="color: #f8f8f2">array_data_feature</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #66d9ef">double</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">pointArrays</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span><span style="color: #f92672">()][];</span>

      <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">k</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f92672">;</span><span style="color: #f8f8f2">k</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">pointArrays</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span><span style="color: #f92672">();</span><span style="color: #f8f8f2">k</span><span style="color: #f92672">++)</span>
      <span style="color: #f92672">{</span>
       <span style="color: #f8f8f2">array_data_feature</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">k</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pointArrays</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">k</span><span style="color: #f92672">);</span>
       <span style="color: #f8f8f2">array_startP_feature</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">k</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">totalLengthFeature</span><span style="color: #f92672">;</span>
       <span style="color: #f8f8f2">totalLengthFeature</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">pointArrays</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">k</span><span style="color: #f92672">).</span><span style="color: #a6e22e">length</span><span style="color: #f92672">;</span>
     <span style="color: #f92672">}</span>

     <span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">featuretableSize</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">totalLengthFeature</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">nFeature</span><span style="color: #f92672">;</span>

   <span style="color: #75715e">//initializing Numeric Table</span>
     <span style="color: #f8f8f2">NumericTable</span> <span style="color: #f8f8f2">featureArray_daal</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">HomogenNumericTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">daal_Context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Double</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">nFeature</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">featuretableSize</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">NumericTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">AllocationFlag</span><span style="color: #f92672">.</span><span style="color: #a6e22e">DoAllocate</span><span style="color: #f92672">);</span>
</pre></div>

<h4 id="step-2-on-data-nodes:356f582a1f3b0ca144998525c9d17238">Step 2 (on data nodes)</h4>

<p>DistributedStep1Local is created for local computation. Computed partial results are sent to master node by <strong>reduce</strong> function.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">DistributedStep1Local</span> <span style="color: #f8f8f2">algorithm</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DistributedStep1Local</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">daal_Context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Float</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Method</span><span style="color: #f92672">.</span><span style="color: #a6e22e">defaultDense</span><span style="color: #f92672">);</span>

    <span style="color: #75715e">/* Set input objects for the algorithm */</span>
    <span style="color: #f8f8f2">algorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">set</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">InputId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">data</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">featureArray_daal</span><span style="color: #f92672">);</span>

    <span style="color: #75715e">/* Compute partial estimates on nodes */</span>
    <span style="color: #f8f8f2">partialResult</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">algorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compute</span><span style="color: #f92672">();</span>
    <span style="color: #f8f8f2">ts2</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">currentTimeMillis</span><span style="color: #f92672">();</span>
    <span style="color: #f8f8f2">compute_time</span> <span style="color: #f92672">+=</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">ts2</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">ts1</span><span style="color: #f92672">);</span>

    <span style="color: #f8f8f2">ts1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">currentTimeMillis</span><span style="color: #f92672">();</span>
    <span style="color: #f8f8f2">partialResultTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addPartition</span><span style="color: #f92672">(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Partition</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getSelfID</span><span style="color: #f92672">(),</span> <span style="color: #f8f8f2">serializePartialResult</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">partialResult</span><span style="color: #f92672">)));</span>
    <span style="color: #66d9ef">boolean</span> <span style="color: #f8f8f2">reduceStatus</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">false</span><span style="color: #f92672">;</span>
    <span style="color: #f8f8f2">reduceStatus</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">reduce</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;cov&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;sync-partialresult&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">partialResultTable</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getMasterID</span><span style="color: #f92672">());</span> 
</pre></div>

<h4 id="step-3-only-on-master-nodes:356f582a1f3b0ca144998525c9d17238">Step 3 (only on master nodes)</h4>

<p>Final result is computed on master node.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span> <span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">isMaster</span><span style="color: #f92672">()){</span>
    <span style="color: #66d9ef">int</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">pid</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">partialResultTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getPartitionIDs</span><span style="color: #f92672">().</span><span style="color: #a6e22e">toIntArray</span><span style="color: #f92672">();</span>
    <span style="color: #f8f8f2">DistributedStep2Master</span> <span style="color: #f8f8f2">algorithm</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DistributedStep2Master</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">daal_Context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Float</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Method</span><span style="color: #f92672">.</span><span style="color: #a6e22e">defaultDense</span><span style="color: #f92672">);</span>
    <span style="color: #f8f8f2">ts1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">currentTimeMillis</span><span style="color: #f92672">();</span>
    <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">j</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">j</span><span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">pid</span><span style="color: #f92672">.</span><span style="color: #a6e22e">length</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">j</span><span style="color: #f92672">++){</span>
      <span style="color: #66d9ef">try</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">algorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">add</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">DistributedStep2MasterInputId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">partialResults</span><span style="color: #f92672">,</span>
          <span style="color: #f8f8f2">deserializePartialResult</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">partialResultTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getPartition</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">pid</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">]).</span><span style="color: #a6e22e">get</span><span style="color: #f92672">()));</span> 
      <span style="color: #f92672">}</span> <span style="color: #66d9ef">catch</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">Exception</span> <span style="color: #f8f8f2">e</span><span style="color: #f92672">)</span> 
      <span style="color: #f92672">{</span>  
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Fail to deserilize partialResultTable&quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">e</span><span style="color: #f92672">.</span><span style="color: #a6e22e">toString</span><span style="color: #f92672">());</span>
        <span style="color: #f8f8f2">e</span><span style="color: #f92672">.</span><span style="color: #a6e22e">printStackTrace</span><span style="color: #f92672">();</span>
      <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>
    <span style="color: #f8f8f2">ts2</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">currentTimeMillis</span><span style="color: #f92672">();</span>
    <span style="color: #f8f8f2">comm_time</span> <span style="color: #f92672">+=</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">ts2</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">ts1</span><span style="color: #f92672">);</span>

    <span style="color: #f8f8f2">ts1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">currentTimeMillis</span><span style="color: #f92672">();</span>
    <span style="color: #f8f8f2">algorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compute</span><span style="color: #f92672">();</span>
    <span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">algorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">finalizeCompute</span><span style="color: #f92672">();</span>
    <span style="color: #f92672">}</span>
</pre></div>

<h4 id="setting-up-hadoop-and-harp-daal:356f582a1f3b0ca144998525c9d17238">Setting up Hadoop and Harp-daal</h4>

<p>Details about setting up hadoop along with harp-daal on the cluster can be found <a href="https://dsc-spidal.github.io/harp/docs/getting-started-cluster/">here</a>.</p>

<h4 id="running-the-code:356f582a1f3b0ca144998525c9d17238">Running the code</h4>

<p>Make sure that the code is placed in the <code>/harp/harp-daal-app</code> directory.
Run the <code>harp-daal-cov-hsw.sh</code> script here to run the code.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">#!/bin/bash</span>

<span style="color: #f8f8f2">Arch</span><span style="color: #f92672">=</span>hsw

cp ../target/harp-daal-app-1.0-SNAPSHOT.jar <span style="color: #e6db74">${</span><span style="color: #f8f8f2">HADOOP_HOME</span><span style="color: #e6db74">}</span>

<span style="color: #f8f8f2">source</span> /N/u/lc37/Lib/DAAL2018_Beta/__release_lnx/daal/bin/daalvars.sh intel64
<span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&quot;${</span><span style="color: #f8f8f2">DAALROOT</span><span style="color: #e6db74">}&quot;</span>

<span style="color: #f8f8f2">cd</span> <span style="color: #e6db74">${</span><span style="color: #f8f8f2">HADOOP_HOME</span><span style="color: #e6db74">}</span>

hdfs dfsadmin -safemode get <span style="color: #f8f8f2">|</span> grep -q <span style="color: #e6db74">&quot;ON&quot;</span>
<span style="color: #66d9ef">if</span> <span style="color: #f92672">[[</span> <span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">$?</span><span style="color: #e6db74">&quot;</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;0&quot;</span> <span style="color: #f92672">]]</span><span style="color: #f8f8f2">;</span> <span style="color: #66d9ef">then</span>
    hdfs dfsadmin -safemode leave
<span style="color: #66d9ef">fi</span>

<span style="color: #75715e"># put daal and tbb, omp libs to hdfs, they will be loaded into the distributed cache</span>
hdfs dfs -mkdir -p /Hadoop/Libraries
hdfs dfs -rm /Hadoop/Libraries/*
hdfs dfs -put <span style="color: #e6db74">${</span><span style="color: #f8f8f2">DAALROOT</span><span style="color: #e6db74">}</span>/lib/intel64_lin/libJavaAPI.so /Hadoop/Libraries/
hdfs dfs -put <span style="color: #e6db74">${</span><span style="color: #f8f8f2">TBBROOT</span><span style="color: #e6db74">}</span>/lib/intel64_lin/gcc4.4/libtbb* /Hadoop/Libraries/
hdfs dfs -put <span style="color: #e6db74">${</span><span style="color: #f8f8f2">DAALROOT</span><span style="color: #e6db74">}</span>/../../omp/lib/libiomp5.so /Hadoop/Libraries/

<span style="color: #75715e"># use the path at account lc37</span>
<span style="color: #f8f8f2">logDir</span><span style="color: #f92672">=</span>/N/u/lc37/HADOOP/Test_longs/logs
<span style="color: #f8f8f2">export</span> <span style="color: #f8f8f2">LIBJARS</span><span style="color: #f92672">=</span><span style="color: #e6db74">${</span><span style="color: #f8f8f2">DAALROOT</span><span style="color: #e6db74">}</span>/lib/daal.jar

<span style="color: #f8f8f2">Arch</span><span style="color: #f92672">=</span>hsw

<span style="color: #f8f8f2">Dataset</span><span style="color: #f92672">=</span>daal_cov_dense
<span style="color: #f8f8f2">Mem</span><span style="color: #f92672">=</span>110000
<span style="color: #75715e"># Batch=50</span>
<span style="color: #75715e"># num of mappers (nodes)</span>
<span style="color: #f8f8f2">Node</span><span style="color: #f92672">=</span>2
<span style="color: #75715e"># num of threads on each mapper(node)</span>
<span style="color: #f8f8f2">Thd</span><span style="color: #f92672">=</span>8

<span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&quot;Test-</span><span style="color: #f8f8f2">$Arch</span><span style="color: #e6db74">-daal-cov-</span><span style="color: #f8f8f2">$Dataset</span><span style="color: #e6db74">-N</span><span style="color: #f8f8f2">$Node</span><span style="color: #e6db74">-T</span><span style="color: #f8f8f2">$Thd</span><span style="color: #e6db74"> Start&quot;</span> 
<span style="color: #75715e"># hadoop jar harp-daal-app-1.0-SNAPSHOT.jar edu.iu.daal_cov.COVDaalLauncher -libjars ${LIBJARS}  /Hadoop/cov-input/$Dataset/train /Hadoop/cov-input/$Dataset/test /Hadoop/cov-input/$Dataset/groundTruth /cov/work $Mem $Batch $Node $Thd 2&gt;$logDir/Test-$Arch-daal-cov-$Dataset-N$Node-T$Thd-B$Batch.log </span>
hadoop jar harp-daal-app-1.0-SNAPSHOT.jar edu.iu.daal_cov.COVDaalLauncher -libjars <span style="color: #e6db74">${</span><span style="color: #f8f8f2">LIBJARS</span><span style="color: #e6db74">}</span>  /Hadoop/cov-input/<span style="color: #f8f8f2">$Dataset</span>  /cov/work <span style="color: #f8f8f2">$Mem</span> <span style="color: #f8f8f2">$Node</span> <span style="color: #f8f8f2">$Thd</span> 2&gt;<span style="color: #f8f8f2">$logDir</span>/Test-<span style="color: #f8f8f2">$Arch</span>-daal-cov-<span style="color: #f8f8f2">$Dataset</span>-N<span style="color: #f8f8f2">$Node</span>-T<span style="color: #f8f8f2">$Thd</span>.log 
<span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&quot;Test-</span><span style="color: #f8f8f2">$Arch</span><span style="color: #e6db74">-daal-cov-</span><span style="color: #f8f8f2">$Dataset</span><span style="color: #e6db74">-N</span><span style="color: #f8f8f2">$Node</span><span style="color: #e6db74">-T</span><span style="color: #f8f8f2">$Thd</span><span style="color: #e6db74"> End&quot;</span> 
</pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>