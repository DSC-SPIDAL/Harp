<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@heronstreaming"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="The First Fit Decreasing Packing Algorithm"><meta property="og:url" content="/docs/developers/packing/ffdpacking/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - The First Fit Decreasing Packing Algorithm</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="getting-started" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-getting-started" aria-labelledby="getting-started"><i class="fa fa-caret-right"></i>Getting Started</a></h4></section><div id="collapse-getting-started" class="panel-collapse collapse" aria-labelledby="getting-started"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-concepts" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-concepts" aria-labelledby="harp-concepts"><i class="fa fa-caret-right"></i>Harp Concepts</a></h4></section><div id="collapse-harp-concepts" class="panel-collapse collapse" aria-labelledby="harp-concepts"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/concepts/features">Features</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/concepts/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="data-interfaces-and-types" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-data-interfaces-and-types" aria-labelledby="data-interfaces-and-types"><i class="fa fa-caret-right"></i>Data Interfaces and Types</a></h4></section><div id="collapse-data-interfaces-and-types" class="panel-collapse collapse" aria-labelledby="data-interfaces-and-types"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/data-interface">Data Interfaces and Types</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="schedulers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-schedulers" aria-labelledby="schedulers"><i class="fa fa-caret-right"></i>Schedulers</a></h4></section><div id="collapse-schedulers" class="panel-collapse collapse" aria-labelledby="schedulers"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/scheduler/static-scheduler">Static Scheduler</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/scheduler/dynamic-scheduler">Dynamic Scheduler</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">k-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/allreducekmeans">allreduce k-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/bcastreducekmeans">broadcast &amp; reduce k-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/pushpullkmeans">push &amp; pull k-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/regroupallgatherkmeans">regroup &amp; allgather k-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/latentdirichletallocation">latent dirichlet allocation</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">LDA</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">SVM</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Harp-DAAL</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Example">Example</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/contributors">Contributors</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>The First Fit Decreasing Packing Algorithm</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<h3 id="overview">Overview</h3>

<p>This guide provides basic steps at using and tuning the First Fit Decreasing packing algorithm in
order to  utilize the resources efficiently. This packing algorithm aims at utilizing as few
containers as possible, thus limiting the overall resources used. The algorithm is based on the
First Fit Decreasing heuristic for the <a href="https://en.wikipedia.org/wiki/Bin_packing_problem">Binpacking problem</a>.
The algorithm is useful in the following scenarios:</p>

<ol>
<li>The user does not know how many containers to use. This algorithm decides the number of
containers to be used and thus the user does not have to specify the number of containers
in the topology configuration.</li>
<li>The user wants to minimize the resource consumption. The First Fit Decreasing packing algorithm
uses a minimum number of containers in order to reduce the resources allocated to the topology.
Note that for each new container, a stream manager process will be launched which will increase
the amount of resources used. Thus, reducing the number of containers can result in further
resource savings.</li>
<li>The user expects that the provisioned per-instance RAM would be either the one specified in the
component RAM or the default value. The algorithm guarantees that the placement of instances in
the containers will never result in an allocation that assigns to one or more instances a smaller
amount of RAM than expected.</li>
</ol>

<p>To enable the First Fit Decreasing
algorithm, update the <code>packing.yaml</code> file as follows:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e"># packing algorithm for packing instances into containers</span>
<span style="color: #ae81ff">heron.class.packing.algorithm</span><span style="color: #f8f8f2">:</span>    <span style="color: #ae81ff">com.twitter.heron.packing.binpacking.FirstFitDecreasingPacking</span>
</pre></div>

<p>The algorithm accepts as input the values of the following parameters:</p>

<ol>
<li>Component RAM</li>
<li>Hint for the maximum container RAM
(<code>com.twitter.heron.api.Config.TOPOLOGY_CONTAINER_MAX_RAM_HINT</code>)</li>
<li>Hint for the maximum container CPU
(<code>com.twitter.heron.api.Config.TOPOLOGY_CONTAINER_MAX_CPU_HINT</code>)</li>
<li>Hint for the maximum container Disk
(<code>com.twitter.heron.api.Config.TOPOLOGY_CONTAINER_MAX_DISK_HINT</code>)</li>
<li>Padding percentage (<code>com.twitter.heron.api.Config.TOPOLOGY_CONTAINER_PADDING_PERCENTAGE</code>)</li>
<li>Component Parallelisms</li>
</ol>

<p>Parameter 1 determines the RAM requirement of each component in the topology.
If the requirement is not specified then a default value of 1GB is used. The First Fit Decreasing
algorithm guarantees that the amount of memory allocated to a component is either the one specified
by the user or the default one.</p>

<p>The parameters 2-4 determine the maximum container size with respect to RAM, cpu cores and disk.
If one of these parameters is not specified by the user then
the hint for the corresponding maximum container resource is set to the default resource requirement
of 4 Heron instances.</p>

<p>Note that these values take into account only the resources allocated for the user&rsquo;s instances.
Additional per container resources for system-related processes such as the stream manager can be
added to the maximum container size defined above. Thus, the algorithm might eventually produce
containers slightly bigger that the boundary determined by parameters 2-4. The amount of the
additional resources allocated to each container to account for additional internal Heron resource
requirements, is determined by the padding percentage specified in parameter 5. If the user does
not specify the padding percentage, then the system will use a default value of 10.
In this case, after a container has been filled with user instances, an additional 10% of resources
will be allocated to it.</p>

<p>Based on these parameters, the algorithm decides how to place the instances in the containers
and how many containers to use. More specifically, the algorithm first sorts the instances in
decreasing order of their RAM requirements. It then picks the instance on the head of the sorted
list and places it in the first container that has enough resources (RAM, cpu cores, disk) to
accommodate it. If none of the existing containers have the requires resources, then a new container
is allocated. Note that if an the RAM requirements of an instance exceed the value of
parameter 2, then the algorithm returns an empty packing plan. After all the instances have
been allocated to the containers, the algorithm adds the per-container padding resources
as specified by parameter 5. The packing plan produced by the First Fit Decreasing packing algorithm
can contain heterogeneous containers. Note that the algorithm does not require the number of
containers as input.</p>

<h3 id="configuring-the-first-fit-decreasing-packing-algorithm">Configuring the First Fit Decreasing Packing Algorithm</h3>

<ol>
<li><p>The methods <code>com.twitter.heron.api.Config.setContainerMaxRamHint(long bytes)</code>,
<code>com.twitter.heron.api.Config.setContainerMaxCpuHint(float ncpus)</code>,
<code>com.twitter.heron.api.Config.setContainerMaxDiskHint(long bytes)</code>
can be used to set parameters 2-4 when defining a topology.</p></li>

<li><p>The <code>com.twitter.heron.api.Config.setContainerPaddingPercentage(int percentage)</code>
method can be used to set the padding percentage
defined in parameter 5 when defining a topology.</p></li>
</ol>

<p>Here&rsquo;s an example code snippet for setting these parameters when defining a topology:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>     <span style="color: #75715e">// Set up the topology and its config</span>
     <span style="color: #f8f8f2">com</span><span style="color: #f92672">.</span><span style="color: #a6e22e">twitter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">heron</span><span style="color: #f92672">.</span><span style="color: #a6e22e">api</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Config</span> <span style="color: #f8f8f2">topologyConfig</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">com</span><span style="color: #f92672">.</span><span style="color: #a6e22e">twitter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">heron</span><span style="color: #f92672">.</span><span style="color: #a6e22e">api</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Config</span><span style="color: #f92672">();</span>

     <span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">maxContainerRam</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">10L</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">Constants</span><span style="color: #f92672">.</span><span style="color: #a6e22e">GB</span><span style="color: #f92672">;</span>

     <span style="color: #f8f8f2">topologyConfig</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setContainerMaxRamHint</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">maxContainerRam</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">topologyConfig</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setContainerPaddingPercentage</span><span style="color: #f92672">(</span><span style="color: #ae81ff">5</span><span style="color: #f92672">);</span>
</pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>