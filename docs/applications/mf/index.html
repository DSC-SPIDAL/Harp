<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.16-DEV" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content=""><meta property="og:site_name" content="Matrix Factorization"><meta property="og:url" content=""><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Matrix Factorization</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png" width="76%"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Documentation</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion-1" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="installation-guide" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-1" href="#collapse-installation-guide" aria-labelledby="installation-guide"><i class="fa fa-caret-right"></i>Installation Guide</a></h4></section><div id="collapse-installation-guide" class="panel-collapse collapse" aria-labelledby="installation-guide"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/prerequisites">Prerequisites</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation (Single Node)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started-cluster">Harp Installation (Cluster)</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Users Guide</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-2" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-2" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/mf">Matrix Factorization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/sahad">Subgraph Counting</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Contributors Guide</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-3" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">Broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">Reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">Allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">Allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">Regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">Push &amp; Pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">Rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/rf">Random Forests</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/nn">Neural Network</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Harp-DAAL Documentation</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-4" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="overview" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-overview" aria-labelledby="overview"><i class="fa fa-caret-right"></i>Overview</a></h4></section><div id="collapse-overview" class="panel-collapse collapse" aria-labelledby="overview"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Harp-DAAL framework</a></li></ul></div></div></div><div class="panel panel-default"><section id="algorithms" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-algorithms" aria-labelledby="algorithms"><i class="fa fa-caret-right"></i>Algorithms</a></h4></section><div id="collapse-algorithms" class="panel-collapse collapse" aria-labelledby="algorithms"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/kmeans">K-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/mfsgd">Matrix Factorization (SGD)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/als">Recommender System (ALS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/svd">Singular Value Decomposition (SVD)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/pca">Principal Component Analysis (PCA)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/nn">Neural Network</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/qr">QR Decomposition (QR)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/covariance">Covariance</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/moments">Low Order Moments</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/naive_bayes">Naive Bayes</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/linear_regression">Linear Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/ridge_regression">Ridge Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/subgraph">Subgraph Counting</a></li></ul></div></div></div><div class="panel panel-default"><section id="hands-on" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-hands-on" aria-labelledby="hands-on"><i class="fa fa-caret-right"></i>Hands-on</a></h4></section><div id="collapse-hands-on" class="panel-collapse collapse" aria-labelledby="hands-on"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/handson">Tutorial</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Matrix Factorization</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p><img src="https://dsc-spidal.github.io/harp/img/mf-illustration.png" width="50%"  ></p>

<h1 id="understanding-matrix-factorization:352991cffc8c9f4544990a7989638403">Understanding Matrix Factorization</h1>

<p><img src="https://dsc-spidal.github.io/harp/img/sgd-ccd-description.png" width="100%" ></p>

<h3 id="pseudo-code-for-sgd-and-ccd-algorithm:352991cffc8c9f4544990a7989638403">Pseudo code for SGD and CCD algorithm:</h3>

<p><ul class="nav nav-pills">
    <li class="active"><a data-toggle="pill" href="#sgd">SGD</a></li>
    <li ><a data-toggle="pill" href="#ccd">CCD</a></li>
  </ul></p>

<p><div class="tab-content">
    <div id="sgd" class="tab-pane fade in active">
      <h3>SGD</h3>
      <img src="https://dsc-spidal.github.io/harp/img/sgd-algorithm.png" width="100%" >
      </div>
    <div id="ccd" class="tab-pane fade">
      <h3>CCD</h3>
      <img src="https://dsc-spidal.github.io/harp/img/ccd-algorithm.png" width="100%" >
    </div>
  </div></p>

<h1 id="using-model-rotation-to-parallel-mf-algorithms:352991cffc8c9f4544990a7989638403">Using Model Rotation to parallel MF algorithms</h1>

<p>Model rotation is expressed as a collective communication. The operation takes the model part owned by a process and performs the rotation.
By default, the operation sends the model partitions to the next neighbor and receives the model partitions from the last neighbor in a predefined ring
topology of workers. An advanced option is that the ring topology can be dynamically defined before performing the model rotation. Thus, programming model rotation requires just one API.
For local computations inside each worker, they are simply programmed through an interface of “schedule-update”. A scheduler employs a user-defined function to maintain a dynamic order of
model parameter updates and avoid the update conflict. Since the local computation only needs to process the model obtained during the rotation without considering the parallel model updates from
other workers, the code of a parallel machine learning algorithm can be modularized as a process of performing computation and rotating model partitions.</p>

<p>We adopt <code>Model Rotation</code> to parallel SGD and CCD algorithms. The data flow and algorithm are shown as follows:</p>

<p><img src="https://dsc-spidal.github.io/harp/img/model-rotation.png" width="100%" ></p>

<h1 id="performance:352991cffc8c9f4544990a7989638403">Performance</h1>

<table>
  <tr>
    <td width="50%">
      <img src="https://dsc-spidal.github.io/harp/img/2-1-6.png" border=0>
    </td>
    <td width="50%">
      <img src="https://dsc-spidal.github.io/harp/img/2-1-7.png" border=0>
    </td>
  </tr>
</table>

<p><img src="https://dsc-spidal.github.io/harp/img/2-1-4.png" alt="Overview-4" /></p>

<p>Experiments are conducted on a 128-node Intel Haswell cluster at Indiana University. Among them, 32 nodes each have two 18-core Xeon E5-2699 v3 processors (36 cores in total), and 96 nodes each have two 12-core Xeon E5- 2670 v3 processors (24 cores in total). All the nodes have 128 GB memory and are connected by QDR InfiniBand. For our tests, JVM memory is set to &ldquo;-Xmx120000m -Xms120000m&rdquo;, and IPoIB is used for communication.</p>

<p>We use one big dataset which is generated from &ldquo;ClueWeb09&rdquo; to test LDA both on Harp and Petuum.</p>

<p>In SGD, Harp SGD converges faster than NOMAD. On &ldquo;clueweb2&rdquo;, with 30 nodes × 30 threads Xeon E5-2699 v3 nodes, Harp is 58% faster, and with 60 nodes × 20 threads Xeon E5-2670 v3 nodes, Harp is 93% faster when the test RMSE value converges to 1.61. The difference of the convergence speed increases because the random shifting mechanism in NOMAD becomes unstable when the scale goes up.</p>

<p>In CCD, we again test the model convergence speed on &ldquo;clueweb2&rdquo; dataset. The results show that Harp CCD also has comparable performance with CCD++. Note that CCD++ use a different model update order so that the convergence rate based on the same number of model update count is different with Harp CCD. However, the tests on &ldquo;clueweb2&rdquo; reveal that with 30 nodes × 30 threads Xeon E5-2670 v3 nodes Harp CCD is 53% faster than CCD++ and with 60 nodes × 20 threads Xeon E5-2699 v3 nodes Harp CCD is 101% faster than CCD++ when the test RMSE converges to 1.68.</p>

<h1 id="run-sgd-and-ccd-example:352991cffc8c9f4544990a7989638403">Run SGD and CCD example</h1>

<h2 id="data:352991cffc8c9f4544990a7989638403">Data</h2>

<p>You can download public data and transfer to the data format required by sgd and ccd application. Here are some <a href="https://github.iu.edu/IU-Big-Data-Lab/ml-bench/blob/master/dataset/dataset-mf.md">datasets</a> for your reference.</p>

<h3 id="data-format:352991cffc8c9f4544990a7989638403">Data Format</h3>

<p>The format for the data should be a list of <code>&lt;userid, itemid, rating&gt;</code> in the case of a recommendation system.
For example,</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">1</span>    <span style="color: #ae81ff">4026</span>    3.299341
<span style="color: #ae81ff">1</span>    <span style="color: #ae81ff">5990</span>    7.005311
<span style="color: #ae81ff">2</span>    <span style="color: #ae81ff">5988</span>    13.235623
<span style="color: #ae81ff">2</span>    <span style="color: #ae81ff">346</span>    3.518781
<span style="color: #ae81ff">3</span>    <span style="color: #ae81ff">347</span>    2.846904
</pre></div>

<h2 id="usage:352991cffc8c9f4544990a7989638403">Usage</h2>

<h3 id="sgd:352991cffc8c9f4544990a7989638403">SGD</h3>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>hadoop jar harp-java-0.1.0.jar edu.iu.sgd.SGDLauncher &lt;input dir&gt; &lt;r&gt; &lt;lambda&gt; &lt;epsilon&gt; &lt;num of iterations&gt; &lt;training ratio&gt; &lt;num of map tasks&gt; &lt;num of threads per worker&gt; &lt;schedule ratio&gt;&lt;memory <span style="color: #f92672">(</span>MB<span style="color: #f92672">)</span>&gt;  &lt;work dir&gt; &lt;<span style="color: #f8f8f2">test</span> dir&gt;

	&lt;input dir&gt;				<span style="color: #f8f8f2">;</span> input directory	
	&lt;r&gt; &lt;lambda&gt; &lt;epsilon&gt;	<span style="color: #f8f8f2">;</span> hyper-parameters, different <span style="color: #66d9ef">for</span> different datasets
	&lt;num of iterations&gt;		<span style="color: #f8f8f2">;</span> iteratoin number
	&lt;training ratio&gt;		<span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">set</span> the percentage of training to utilize timer control of synchronization
	&lt;num of map tasks&gt;		<span style="color: #f8f8f2">;</span>
	&lt;num of threads per worker&gt;		<span style="color: #f8f8f2">;</span>
	&lt;schedule ratio&gt;		<span style="color: #f8f8f2">;</span> blocks partition ratio <span style="color: #66d9ef">for</span> dynamic scheduler, <span style="color: #ae81ff">2</span> means spliting to 2xThread# X 2xMapper# blocks
	&lt;memory <span style="color: #f92672">(</span>MB<span style="color: #f92672">)</span>&gt;			<span style="color: #f8f8f2">;</span> memory setting <span style="color: #66d9ef">for</span> JVM
	&lt;work dir&gt;				<span style="color: #f8f8f2">;</span> working directory, model saved in this directory
	&lt;<span style="color: #f8f8f2">test</span> dir&gt;				<span style="color: #f8f8f2">;</span> directory <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">test</span> files
</pre></div>

<h3 id="example:352991cffc8c9f4544990a7989638403">Example</h3>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">#put data onto hdfs</span>
cp <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/datasets/tutorial/movielens/* .
bunzip2 movie*.mm.bz2
mkdir data
<span style="color: #f8f8f2">cd</span> data/
split -a <span style="color: #ae81ff">5</span> -l <span style="color: #ae81ff">10000</span> ../movielens-train.mm
<span style="color: #f8f8f2">cd</span> ..
hadoop fs -mkdir -p /harp-test/mf/test
hadoop fs -put data /harp-test/mf/
hadoop fs -put movielens-test.mm /harp-test/mf/test

<span style="color: #75715e">#run lda training</span>
hadoop jar harp-java-0.1.0.jar edu.iu.sgd.SGDLauncher /harp-test/mf/data <span style="color: #ae81ff">40</span> 0.05 0.003 <span style="color: #ae81ff">100</span> <span style="color: #ae81ff">100</span> <span style="color: #ae81ff">10</span> <span style="color: #ae81ff">16</span> <span style="color: #ae81ff">2</span> <span style="color: #ae81ff">10000</span> /harp-test/mfwork/ /harp-test/mf/test/


<span style="color: #75715e">### CCD</span>
<span style="color: #e6db74">```</span>bash
hadoop jar harp-java-0.1.0.jar edu.iu.ccd.CCDLauncher &lt;input dir&gt; &lt;r&gt; &lt;lambda&gt; &lt;num of iterations&gt; &lt;num of map tasks&gt; &lt;num of threads per worker&gt; &lt;num of model slices&gt; &lt;work dir&gt; &lt;<span style="color: #f8f8f2">test</span> dir&gt;
</pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>