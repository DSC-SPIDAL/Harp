<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="Harp-DAAL-ALS"><meta property="og:url" content="/docs/harpdaal/als/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Harp-DAAL-ALS</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png" width="76%"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://github.com/DSC-SPIDAL/harp/">GitHub</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/survey">Feedback</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="quick-start" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-quick-start" aria-labelledby="quick-start"><i class="fa fa-caret-right"></i>Quick Start</a></h4></section><div id="collapse-quick-start" class="panel-collapse collapse" aria-labelledby="quick-start"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation (single)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started-cluster">Harp Installation (cluster)</a></li></ul></div></div></div><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/rf">Random Forests</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/nn">Neural Network</a></li></ul></div></div></div><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/mf">Matrix Factorization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/sahad">Sub-graph Counting</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/kmeans">K-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/mfsgd">Matrix Factorization (SGD)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/als">Recommender System (ALS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/svd">Singular Value Decomposition (SVD)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/pca">Principal Component Analysis (PCA)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/nn">Neural Network</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/qr">QR Decomposition (QR)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/covariance">Covariance</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/moments">Low Order Moments</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/naive_bayes">Naive Bayes</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/linear_regression">Linear Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/ridge_regression">Ridge Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/handson">Hands-on</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/contributors">Contributors</a></li></ul></div></div></div><div class="panel panel-default"><section id="user-feedback" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-user-feedback" aria-labelledby="user-feedback"><i class="fa fa-caret-right"></i>User Feedback</a></h4></section><div id="collapse-user-feedback" class="panel-collapse collapse" aria-labelledby="user-feedback"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/survey">Online Survey</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Harp-DAAL-ALS</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<h2 id="alternating-least-squares-in-collaborative-filtering">Alternating least squares in Collaborative Filtering</h2>

<p>Alternating least squares (ALS) is another frequently used algorithm to decompose rating matrices in recommender systems.
Like MF-SGD, ALS is training the model data X and Y to minimize the cost function as below</p>

<p><img src="https://dsc-spidal.github.io/harp/img/als-training-costfunction.png" width="50%" height="50%"><br>
<img src="https://dsc-spidal.github.io/harp/img/als-training-costfunction-2.png" width="30%" height="30%"><br></p>

<p>where</p>

<ul>
<li>c_ui measures the confidence in observing p_ui</li>
<li>alpha is the rate of confidence</li>
<li>r_ui is the element of the matrix R</li>
<li>labmda is the parameter of the regularization</li>
<li>n_xu, m_yi denote the number of ratings of user u and item i respectively.</li>
</ul>

<p>Unlike MF-SGD, ALS alternatively computes model x and y independently of each other in the following formula:</p>

<p><img src="https://dsc-spidal.github.io/harp/img/als-x-compute-1.png" width="20%" height="20%"><br>
<img src="https://dsc-spidal.github.io/harp/img/als-x-compute-2.png" width="50%" height="50%"><br>
<img src="https://dsc-spidal.github.io/harp/img/als-y-compute-1.png" width="20%" height="20%"><br>
<img src="https://dsc-spidal.github.io/harp/img/als-y-compute-2.png" width="50%" height="50%"><br></p>

<p>The algorithm has a computation complexity for each iteration as</p>

<p><img src="https://dsc-spidal.github.io/harp/img/als-complexity-1.png" width="30%" height="30%"><br></p>

<p>Omega is the set of training samples, K is the feature dimension, m is the row number of the rating
matrix, and n is the column number of the rating matrix.</p>

<h2 id="implementation">Implementation</h2>

<p>The implementation of ALS in our Harp-DAAL consists of two levels.
At the top Level, using Harp&rsquo;s <em>regroup</em> and <em>allgather</em> operation to communication model data among mappers
At the bottom Level, using DAAL&rsquo;s ALS kernels to conduct local computations.</p>

<h2 id="a-code-walk-through-of-harp-daal-als">A Code Walk Through of Harp-DAAL-ALS</h2>

<h3 id="load-training-data">Load Training Data</h3>

<p>Harp-DAAL-ALS uses both of the original training matrix and the transposed matrix, therefore we load the training matrix data twice. In the
second load process, we exchanged the row and column indices of each training point to make a transposed matrix.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">VRowCol</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">trainDataMap</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SGDUtil</span><span style="color: #f92672">.</span><span style="color: #a6e22e">loadVMapRow</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">vFilePaths</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads_harp</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">configuration</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">VRowCol</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">trainDataMapTran</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SGDUtil</span><span style="color: #f92672">.</span><span style="color: #a6e22e">loadVMapTran</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">vFilePaths</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads_harp</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">configuration</span><span style="color: #f92672">);</span>
</pre></div>

<h3 id="format-conversion">Format Conversion</h3>

<p>The default Sparse Matrix format of Harp is Coordinate Format (COO), which represents a training point in triple values (RowID, ColID, val), whereas, the
sparse matrix format for DAAL ALS kernel is Compressed Sparse Row Format (CSR). Therefore, the first step is to convert incoming training data from COO to
CSR. Before converting sparse data format, a remapping process of row/column indices are required to make sure that no empty row or column will occur
in the CSR format.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//remapping row ids</span>
<span style="color: #f8f8f2">ReMapRowColID</span> <span style="color: #f8f8f2">remapper_row</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ReMapRowColID</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">rowIds</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getSelfID</span><span style="color: #f92672">(),</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getNumWorkers</span><span style="color: #f92672">(),</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">);</span>
<span style="color: #66d9ef">int</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">row_mapping</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">remapper_row</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getRemapping</span><span style="color: #f92672">();</span>

<span style="color: #75715e">//remapping col ids</span>
<span style="color: #f8f8f2">ReMapRowColID</span> <span style="color: #f8f8f2">remapper_col</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ReMapRowColID</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">colIds</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getSelfID</span><span style="color: #f92672">(),</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getNumWorkers</span><span style="color: #f92672">(),</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">);</span>
<span style="color: #66d9ef">int</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">col_mapping</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">remapper_col</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getRemapping</span><span style="color: #f92672">();</span>
</pre></div>

<p>We then do a data format conversion by using a conversion class named <em>COOToCSR</em></p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">COOToCSR</span> <span style="color: #f8f8f2">converter</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">COOToCSR</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainDataTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">col_mapping</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">CSRNumericTable</span> <span style="color: #f8f8f2">trainDaalTable</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">converter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">convert</span><span style="color: #f92672">();</span>

<span style="color: #f8f8f2">COOToCSR</span> <span style="color: #f8f8f2">converter_tran</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">COOToCSR</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainDataTableTran</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">row_mapping</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">CSRNumericTable</span> <span style="color: #f8f8f2">trainDaalTableTran</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">converter_tran</span><span style="color: #f92672">.</span><span style="color: #a6e22e">convert</span><span style="color: #f92672">();</span>
</pre></div>

<h3 id="initialize-daal-variables">Initialize DAAL Variables</h3>

<p>The DAAL ALS kernel has the following important variables. Some of them are local to each mapper (node), while others require
a global synchronization among different mapper (nodes).</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//store the offset of rows/columns i </span>
<span style="color: #66d9ef">long</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">usersPartition</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #66d9ef">long</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">workerNum</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">];</span>
<span style="color: #66d9ef">long</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">itemsPartition</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #66d9ef">long</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">workerNum</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">];</span>

<span style="color: #75715e">//local var</span>
<span style="color: #f8f8f2">KeyValueDataCollection</span> <span style="color: #f8f8f2">usersOutBlocks</span><span style="color: #f92672">;</span>
<span style="color: #75715e">//local var</span>
<span style="color: #f8f8f2">KeyValueDataCollection</span> <span style="color: #f8f8f2">itemsOutBlocks</span><span style="color: #f92672">;</span>

<span style="color: #75715e">//local var, sync on master node</span>
<span style="color: #f8f8f2">DistributedPartialResultStep1</span> <span style="color: #f8f8f2">step1LocalResult</span><span style="color: #f92672">;</span>
<span style="color: #75715e">//global var</span>
<span style="color: #f8f8f2">NumericTable</span> <span style="color: #f8f8f2">step2MasterResult</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
<span style="color: #75715e">//local var</span>
<span style="color: #f8f8f2">KeyValueDataCollection</span> <span style="color: #f8f8f2">step3LocalResult</span><span style="color: #f92672">;</span>
<span style="color: #75715e">//global vars</span>
<span style="color: #f8f8f2">KeyValueDataCollection</span> <span style="color: #f8f8f2">step4LocalInput</span><span style="color: #f92672">;</span>
<span style="color: #75715e">//local vars</span>
<span style="color: #f8f8f2">DistributedPartialResultStep4</span> <span style="color: #f8f8f2">itemsPartialResultLocal</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
<span style="color: #75715e">//local vars</span>
<span style="color: #f8f8f2">DistributedPartialResultStep4</span> <span style="color: #f8f8f2">usersPartialResultLocal</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
</pre></div>

<p><em>usersPartition</em> (<em>itemsPartition</em>) record the start position of rows of distributed CSR formatted training matrix (transposed training matrix) on each mapper.
<em>usersOutBlocks</em> (<em>itemsOutBlocks</em>) store the row/column indices that would be required by other mappers.
<em>step1LocalResult</em>, <em>step2MasterResult</em>, <em>step3LocalResult</em>, and <em>step4LocalInput</em> are intermediate results of each training step.
<em>itemsPartialResultLocal</em> and <em>usersPartialResultLocal</em> store the final model data (low rank matrix x and y).</p>

<p>The following codes initialize these variables</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">InitDistributed</span> <span style="color: #f8f8f2">initAlgorithm</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">InitDistributed</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">daal_Context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Double</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">InitMethod</span><span style="color: #f92672">.</span><span style="color: #a6e22e">fastCSR</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">initAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">parameter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setFullNUsers</span><span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">maxRowID</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">initAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">parameter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setNFactors</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">r</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">initAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">parameter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setNumThreads</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">initAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">parameter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setSeed</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">initAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">parameter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getSeed</span><span style="color: #f92672">()</span> <span style="color: #f92672">+</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getSelfID</span><span style="color: #f92672">());</span>
<span style="color: #f8f8f2">initAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">set</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">InitInputId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">data</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">trainDaalTableTran</span><span style="color: #f92672">);</span>

<span style="color: #75715e">// Initialize the implicit ALS model</span>
<span style="color: #f8f8f2">InitPartialResult</span> <span style="color: #f8f8f2">initPartialResult</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">initAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compute</span><span style="color: #f92672">();</span>

<span style="color: #75715e">// partialModel is local on each node</span>
<span style="color: #f8f8f2">PartialModel</span> <span style="color: #f8f8f2">partialModel</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">initPartialResult</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">InitPartialResultId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">partialModel</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">itemsPartialResultLocal</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DistributedPartialResultStep4</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">daal_Context</span><span style="color: #f92672">);</span>

<span style="color: #75715e">//store the partialModel on local slave node</span>
<span style="color: #f8f8f2">itemsPartialResultLocal</span><span style="color: #f92672">.</span><span style="color: #a6e22e">set</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">DistributedPartialResultStep4Id</span><span style="color: #f92672">.</span><span style="color: #a6e22e">outputOfStep4ForStep1</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">partialModel</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">step4LocalInput</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">KeyValueDataCollection</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">daal_Context</span><span style="color: #f92672">);</span>

<span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">dataTableRows</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">trainDaalTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getNumberOfRows</span><span style="color: #f92672">();</span>
<span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">dataTableTranRows</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">trainDaalTableTran</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getNumberOfRows</span><span style="color: #f92672">();</span>

<span style="color: #75715e">//allreduce to get the users and items partition table</span>
<span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">LongArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">dataTable_partition</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">LongArrPlus</span><span style="color: #f92672">());</span>

<span style="color: #f8f8f2">LongArray</span> <span style="color: #f8f8f2">partition_array</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">LongArray</span><span style="color: #f92672">.</span><span style="color: #a6e22e">create</span><span style="color: #f92672">(</span><span style="color: #ae81ff">2</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">false</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">partition_array</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">()[</span><span style="color: #ae81ff">0</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">dataTableRows</span><span style="color: #f92672">;</span>
<span style="color: #f8f8f2">partition_array</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">()[</span><span style="color: #ae81ff">1</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">dataTableTranRows</span><span style="color: #f92672">;</span>

<span style="color: #f8f8f2">dataTable_partition</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addPartition</span><span style="color: #f92672">(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Partition</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getSelfID</span><span style="color: #f92672">(),</span> <span style="color: #f8f8f2">partition_array</span><span style="color: #f92672">));</span>

<span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">allgather</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;als&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;get-partition-info&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">dataTable_partition</span><span style="color: #f92672">);</span>

<span style="color: #f8f8f2">usersPartition</span><span style="color: #f92672">[</span><span style="color: #ae81ff">0</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>
<span style="color: #f8f8f2">itemsPartition</span><span style="color: #f92672">[</span><span style="color: #ae81ff">0</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>

<span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">j</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f92672">;</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">workerNum</span><span style="color: #f92672">;</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">++)</span>
<span style="color: #f92672">{</span>
<span style="color: #f8f8f2">usersPartition</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">+</span><span style="color: #ae81ff">1</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">usersPartition</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">]</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">dataTable_partition</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getPartition</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">).</span><span style="color: #a6e22e">get</span><span style="color: #f92672">().</span><span style="color: #a6e22e">get</span><span style="color: #f92672">()[</span><span style="color: #ae81ff">0</span><span style="color: #f92672">];</span>
<span style="color: #f8f8f2">itemsPartition</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">+</span><span style="color: #ae81ff">1</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">itemsPartition</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">]</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">dataTable_partition</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getPartition</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">).</span><span style="color: #a6e22e">get</span><span style="color: #f92672">().</span><span style="color: #a6e22e">get</span><span style="color: #f92672">()[</span><span style="color: #ae81ff">1</span><span style="color: #f92672">];</span>

<span style="color: #f92672">}</span>

<span style="color: #75715e">//compute out blocks</span>
<span style="color: #f8f8f2">usersOutBlocks</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">computeOutBlocks</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">daal_Context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">workerNum</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">trainDaalTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">itemsPartition</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">itemsOutBlocks</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">computeOutBlocks</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">daal_Context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">workerNum</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">trainDaalTableTran</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">usersPartition</span><span style="color: #f92672">);</span>
</pre></div>

<p>The initialization of <em>usersPartition</em> and <em>itemsPartition</em> demand a synchronization among mappers, where we use harp&rsquo;s <em>allgather</em> operation.
The training process consists of four steps. Firstly, the four steps will compute model data x (<em>usersPartialResultLocal</em>) while fixing the <em>itemsPartialResultLocal</em> as a constant.
Secondly, the four steps will repeat and compute the <em>itemsPartialResultLocal</em> while fixing <em>usersPartialResultLocal</em> as a constant.</p>

<h3 id="training-process-step-1">Training Process Step 1</h3>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">ALSTrainStep1</span> <span style="color: #f8f8f2">algo_step1</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ALSTrainStep1</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">itemsPartialResultLocal</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">);</span>

<span style="color: #75715e">//compute step 1</span>
<span style="color: #f8f8f2">step1LocalResult</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">algo_step1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compute</span><span style="color: #f92672">();</span>

<span style="color: #75715e">//communication step 1</span>
<span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">ByteArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">step1LocalResult_table</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">algo_step1</span><span style="color: #f92672">.</span><span style="color: #a6e22e">communicate</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">step1LocalResult</span><span style="color: #f92672">);</span>
</pre></div>

<p>In step 1, we create a <em>ALSTrainStep1</em> class, which takes <em>itemsPartialResultLocal</em> as an input argument. We first invoke the <em>compute()</em> method and store the result at
<em>step1LocalResult</em>, which is then communicated among all the mappers by invoking the <em>communicate()</em> function of <em>ALSTrainStep1</em></p>

<h3 id="training-process-step-2">Training Process Step 2</h3>

<p>The computation work of Step 2 happens on the master node, which is the mapper with its id equals zero. The result <em>step2MasterResult</em> is then broadcast to other
slaves nodes by invoking the <em>communicate</em> function.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//step 2 on master node</span>
<span style="color: #f8f8f2">ALSTrainStep2</span> <span style="color: #f8f8f2">algo_step2</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ALSTrainStep2</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">step1LocalResult_table</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">);</span>

<span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getSelfID</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">)</span>
<span style="color: #f92672">{</span>
<span style="color: #f8f8f2">step2MasterResult</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">algo_step2</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compute</span><span style="color: #f92672">();</span>
<span style="color: #f92672">}</span>

<span style="color: #75715e">//free up memory</span>
<span style="color: #f8f8f2">step1LocalResult_table</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
<span style="color: #f8f8f2">step1LocalResult</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>

<span style="color: #75715e">//broadcast step2MasterResult to other slave nodes step2MasterResult is HomogenNumericTable</span>
<span style="color: #f8f8f2">step2MasterResult</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">algo_step2</span><span style="color: #f92672">.</span><span style="color: #a6e22e">communicate</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">step2MasterResult</span><span style="color: #f92672">);</span>
</pre></div>

<h3 id="training-process-step-3">Training Process Step 3</h3>

<p>Step 3 also contains the computation part and a communication part. Each node computes its local <em>step3LocalResult</em> and uses harp table to
accomplish a <em>allgather</em> operation inside the <em>communicate()</em> function of class <em>ALSTrainStep3</em>.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">ALSTrainStep3</span> <span style="color: #f8f8f2">algo_step3</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ALSTrainStep3</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">itemsPartition</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">itemsOutBlocks</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">itemsPartialResultLocal</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">);</span>
<span style="color: #75715e">//compute step 3</span>
<span style="color: #f8f8f2">DistributedPartialResultStep3</span> <span style="color: #f8f8f2">partialResult_step3</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">algo_step3</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compute</span><span style="color: #f92672">();</span>

<span style="color: #75715e">// Prepare input objects for the fourth step of the distributed algorithm</span>
<span style="color: #f8f8f2">step3LocalResult</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">partialResult_step3</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">DistributedPartialResultStep3Id</span><span style="color: #f92672">.</span><span style="color: #a6e22e">outputOfStep3ForStep4</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">ByteArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">step3LocalResult_table</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ByteArrPlus</span><span style="color: #f92672">());</span>

<span style="color: #f8f8f2">step4LocalInput</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">algo_step3</span><span style="color: #f92672">.</span><span style="color: #a6e22e">communicate</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">step3LocalResult</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">step4LocalInput</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">step3LocalResult_table</span><span style="color: #f92672">);</span>
</pre></div>

<h3 id="training-process-step-4">Training Process Step 4</h3>

<p>Finally, the fourth step computes out the <em>usersPartialResultLocal</em> which is local on each node.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">ALSTrainStep4</span> <span style="color: #f8f8f2">algo_step4</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ALSTrainStep4</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">alpha</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">lambda_als</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">step4LocalInput</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">trainDaalTable</span><span style="color: #f92672">,</span>
<span style="color: #f8f8f2">step2MasterResult</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">);</span>

<span style="color: #f8f8f2">usersPartialResultLocal</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">algo_step4</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compute</span><span style="color: #f92672">();</span>
</pre></div>

<h3 id="test-process">Test Process</h3>

<p>After several rounds of training process, we could examine the effectiveness of Harp-DAAL-ALS by computing the root of mean square errors (RMSE) of
a test dataset. Like the training dataset, the test dataset is first loaded into Harp-DAAL-ALS</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">Int2ObjectOpenHashMap</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">VRowCol</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">testDataMap</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SGDUtil</span><span style="color: #f92672">.</span><span style="color: #a6e22e">loadTMapRow</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">testFilePath</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads_harp</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">configuration</span><span style="color: #f92672">);</span>
</pre></div>

<p>Unlike the training dataset that is distributed on all the nodes, each node loads the whole test dataset into its memory space. We could compute
an initial RMSE value before the start of training process. Here, we also use the <em>row_mapping</em> and <em>col_mapping</em> values that records the new row/column
id for the points of test dataset.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">// ------------------------------ compute initial RMSE from test dataset ------------------------------</span>
<span style="color: #f8f8f2">testModelInitRMSE</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">usersPartition</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">itemsPartition</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">dataTableRows</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">testDataMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">row_mapping</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">col_mapping</span><span style="color: #f92672">);</span>
</pre></div>

<p>After training process, we compute again the RMSE value of test dataset</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//test model after this iteration</span>
<span style="color: #f8f8f2">testModel</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">iteration</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">usersPartition</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">itemsPartition</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">usersPartialResultLocal</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">itemsPartialResultLocal</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">testDataMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">row_mapping</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">col_mapping</span><span style="color: #f92672">);</span>
</pre></div>

<p>Comparing the RMSE value before and after the training process, we could evaluate the correctness and efficiency of our Harp-DAAL-ALS algorithm.</p>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>