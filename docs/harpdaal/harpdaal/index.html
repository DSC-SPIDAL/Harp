<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.16-DEV" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content=""><meta property="og:site_name" content="Harp-DAAL Framework"><meta property="og:url" content=""><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Harp-DAAL Framework</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png" width="76%"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://github.com/DSC-SPIDAL/harp/">GitHub</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/survey">Feedback</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="quick-start" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-quick-start" aria-labelledby="quick-start"><i class="fa fa-caret-right"></i>Quick Start</a></h4></section><div id="collapse-quick-start" class="panel-collapse collapse" aria-labelledby="quick-start"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation (single)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started-cluster">Harp Installation (cluster)</a></li></ul></div></div></div><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/rf">Random Forests</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/nn">Neural Network</a></li></ul></div></div></div><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/mf">Matrix Factorization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/sahad">Subgraph Counting</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/kmeans">K-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/mfsgd">Matrix Factorization (SGD)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/als">Recommender System (ALS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/svd">Singular Value Decomposition (SVD)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/pca">Principal Component Analysis (PCA)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/nn">Neural Network</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/qr">QR Decomposition (QR)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/covariance">Covariance</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/moments">Low Order Moments</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/naive_bayes">Naive Bayes</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/linear_regression">Linear Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/ridge_regression">Ridge Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/subgraph">Subgraph Counting</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/handson">Hands-on</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/contributors">Contributors</a></li></ul></div></div></div><div class="panel panel-default"><section id="user-feedback" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-user-feedback" aria-labelledby="user-feedback"><i class="fa fa-caret-right"></i>User Feedback</a></h4></section><div id="collapse-user-feedback" class="panel-collapse collapse" aria-labelledby="user-feedback"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/survey">Online Survey</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Harp-DAAL Framework</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p><img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-1-1.png" width="7.08%"><img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-1-2.png" width="55.54%"><img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-1-3.png" width="7.38%">
<br />
<img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-2-1.png" width="7.08%"><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models/"><img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-2-2.png" width="55.54%"></a><img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-2-3.png" width="7.38%">
<br />
<img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-3-1.png" width="7.08%"><img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-3-2.png" width="55.54%"><img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-3-3.png" width="7.38%">
<br />
<img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-4-1.png" width="7.08%"><a href="https://software.intel.com/en-us/intel-daal"><img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-4-2.png" width="55.54%"></a><img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-4-3.png" width="7.38%">
<br />
<img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-5-1.png" width="7.08%"><img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-5-2.png" width="55.54%"><img src="https://dsc-spidal.github.io/harp/img/6-1-2/6-1-2-5-3.png" width="7.38%"></p>

<p>Figure 1 shows the architecture of Harp-DAAL within the whole HPC-Big Data software stack.</p>

<h2 id="what-is-harp-daal:e39afa43d8f438ef1a106319b10ff5f3">What is Harp-DAAL?</h2>

<p>Harp-DAAL is a new framework that aims to run data analytics algorithms on distributed HPC architectures.
The framework consists of two layers: a communication layer and a computation layer. A communication layer is handled by Harp,
a communication library plug-in into Hadoop ecosystem, and a computation layer is handled by Intel&rsquo;s Data Analytics Acceleration Library (DAAL),
which is a library that provides the users of well optimized building blocks for data analytics and machine learning applications on Intel&rsquo;s architectures.</p>

<p>Compared to contemporary distributed data processing frameworks, such as Hadoop and Spark, Harp has the following advantages:</p>

<ol>
<li>MPI-like collective communication operations that are highly optimized for big data problems.</li>
<li>Efficient and innovative computation models for different machine learning problems.</li>
</ol>

<p>However, the original Harp framework only supports development of Java applications, which is a common choice within the Hadoop ecosystem.
The downside of the pure Java implementation is the lack of support for emerging new hardware architectures such as Intel&rsquo;s Xeon Phi.
By invoking DAAL&rsquo;s native kernels, applications can leverage the huge number of threads on many-core platforms, which is a great
advantage for computation-intensive data analytics algorithms. This is also the tendency of merging HPC and Big Data domain.</p>

<h2 id="how-to-build-a-harp-daal-application:e39afa43d8f438ef1a106319b10ff5f3">How to build a Harp-DAAL Application ?</h2>

<p>If you already have a legacy Harp application codes, you need only identify the local computation module, and replace it by invoking correspondent
DAAL kernels. Although DAAL&rsquo;s kernels are written in C/C++, it does provide users of a Java API. The API is highly packaged, and the users only need
a few lines of codes to finish the invocation of kernels. For instance, the main function of a PCA application in DAAL is shown as below:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">main</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">args</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">java</span><span style="color: #f92672">.</span><span style="color: #a6e22e">io</span><span style="color: #f92672">.</span><span style="color: #a6e22e">FileNotFoundException</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">java</span><span style="color: #f92672">.</span><span style="color: #a6e22e">io</span><span style="color: #f92672">.</span><span style="color: #a6e22e">IOException</span> <span style="color: #f92672">{</span>

     <span style="color: #75715e">/* Read a data set from a file and create a numeric table for storing the input data */</span>
     <span style="color: #f8f8f2">CSRNumericTable</span> <span style="color: #f8f8f2">data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Service</span><span style="color: #f92672">.</span><span style="color: #a6e22e">createSparseTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">datasetFileName</span><span style="color: #f92672">);</span>

     <span style="color: #75715e">/* Create an algorithm to compute PCA decomposition using the correlation method */</span>
     <span style="color: #f8f8f2">Batch</span> <span style="color: #f8f8f2">pcaAlgorithm</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Batch</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Double</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Method</span><span style="color: #f92672">.</span><span style="color: #a6e22e">correlationDense</span><span style="color: #f92672">);</span>

     <span style="color: #f8f8f2">com</span><span style="color: #f92672">.</span><span style="color: #a6e22e">intel</span><span style="color: #f92672">.</span><span style="color: #a6e22e">daal</span><span style="color: #f92672">.</span><span style="color: #a6e22e">algorithms</span><span style="color: #f92672">.</span><span style="color: #a6e22e">covariance</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Batch</span> <span style="color: #f8f8f2">covarianceSparse</span>
         <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">com</span><span style="color: #f92672">.</span><span style="color: #a6e22e">intel</span><span style="color: #f92672">.</span><span style="color: #a6e22e">daal</span><span style="color: #f92672">.</span><span style="color: #a6e22e">algorithms</span><span style="color: #f92672">.</span><span style="color: #a6e22e">covariance</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Batch</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">context</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Double</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">com</span><span style="color: #f92672">.</span><span style="color: #a6e22e">intel</span><span style="color: #f92672">.</span><span style="color: #a6e22e">daal</span><span style="color: #f92672">.</span><span style="color: #a6e22e">algorithms</span><span style="color: #f92672">.</span><span style="color: #a6e22e">covariance</span><span style="color: #f92672">.</span><span style="color: #a6e22e">Method</span><span style="color: #f92672">.</span><span style="color: #a6e22e">fastCSR</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">pcaAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">parameter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setCovariance</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">covarianceSparse</span><span style="color: #f92672">);</span>

     <span style="color: #75715e">/* Set the input data */</span>
     <span style="color: #f8f8f2">pcaAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">input</span><span style="color: #f92672">.</span><span style="color: #a6e22e">set</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">InputId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">data</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">data</span><span style="color: #f92672">);</span>

     <span style="color: #75715e">/* Compute PCA decomposition */</span>
     <span style="color: #f8f8f2">Result</span> <span style="color: #f8f8f2">res</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pcaAlgorithm</span><span style="color: #f92672">.</span><span style="color: #a6e22e">compute</span><span style="color: #f92672">();</span>

     <span style="color: #f8f8f2">NumericTable</span> <span style="color: #f8f8f2">eigenValues</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">res</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">ResultId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">eigenValues</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">NumericTable</span> <span style="color: #f8f8f2">eigenVectors</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">res</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">ResultId</span><span style="color: #f92672">.</span><span style="color: #a6e22e">eigenVectors</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">Service</span><span style="color: #f92672">.</span><span style="color: #a6e22e">printNumericTable</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Eigenvalues:&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">eigenValues</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">Service</span><span style="color: #f92672">.</span><span style="color: #a6e22e">printNumericTable</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Eigenvectors:&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">eigenVectors</span><span style="color: #f92672">);</span>

     <span style="color: #f8f8f2">context</span><span style="color: #f92672">.</span><span style="color: #a6e22e">dispose</span><span style="color: #f92672">();</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>DAAL&rsquo;s Java API is usually contains the following objects:</p>

<ul>
<li>Data: user&rsquo;s data packed in DAAL&rsquo;s data structure, e.g., NumericTable, DataCollection</li>
<li>Algorithm:  the engine of machine learning, each has three modes: Batch, Distri, Online</li>
<li>Input: the user&rsquo;s input data to Algorithm</li>
<li>Parameter: the parameters provided by users during the running of algorithms</li>
<li>Result: the feedback of Algorithm after running, retrieved by users</li>
</ul>

<p>Before invoking your DAAL kernels,the most suitable data structure for the problem should be chosen. For many NumericTable types,
the Java API provides two ways of storing data. One is to store data on the JVM heap side, and whenever the native computation kernels require
the dataset, it will automatically copy the data from JVM heap to the off-heap memory space. The other way is to store data on Java&rsquo;s direct byte buffer, and
native computation kernels can access them directly without any data copy. Therefore, you should evaluate the overhead of loading and writing data from memory
in your application. For many data-intensive applications, it is wise to store the data on the direct byte buffer.</p>

<p>If you build the Harp-DAAL application from scratch, you should also carefully choose the data structure on the Harp side. The thumb rule is to allocate data in
contiguous primitive Java array, because most of DAAL&rsquo;s Java API only accepts primitive array as input arguments. If Harp&rsquo;s own Table structure is used and the
contained data is distributed into different partitions, then you may use the Harp-DAAL data conversion API to transfer the data between a Harp table and a DAAL
table.</p>

<h3 id="harp-daal-data-conversion-api:e39afa43d8f438ef1a106319b10ff5f3">Harp-DAAL Data Conversion API</h3>

<p>Harp-DAAL now provides a group of classes under the path <em>harp/ml/daal/src/edu/iu/daal</em>, which manipulates the data
transfer
between Harp&rsquo;s data structure and that of DAAL.</p>

<ul>
<li>RotatorDaal: a rotator which internally converts the H matrix from Harp table to DAAL&rsquo;s NumericTable</li>
<li>RotateTaskDaal: the tasks executed by RotatorDaal in the model rotation paradigm.</li>
<li>HomogenTableHarpMap: convert data between DAAL&rsquo;s HomogenNumericTable and Harp&rsquo;s map</li>
<li>HomogenTableHarpTable: convert data between DAAL&rsquo;s HomogenNumericTable and Harp&rsquo;s table</li>
</ul>

<p>Within the <em>RotatorDaal</em>, the data transfers between Harp and DAAL is also overlapped by the computation work in another pipeline. Thus, if there is enough computation workload, the
overhead of data conversion could be significantly reduced. It is also very straightforward to invoke these conversion tools.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//create a conversion class between harp map and daal&#39;s table</span>
<span style="color: #f8f8f2">HomogenTableHarpMap</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">double</span><span style="color: #f92672">[]&gt;</span> <span style="color: #f8f8f2">converter</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">HomogenTableHarpMap</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">double</span><span style="color: #f92672">[]&gt;(</span><span style="color: #f8f8f2">wMap</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_index</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_daal</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">wMap_size</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numThreads</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">convert_wTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">HarpToDaalDouble</span><span style="color: #f92672">();</span>

<span style="color: #75715e">//create a conversion class between a harp table and a daal table</span>
<span style="color: #f8f8f2">converter</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">HomogenTableHarpTable</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">I</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">P</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">P</span><span style="color: #f92672">&gt;</span> <span style="color: #f92672">&gt;(</span><span style="color: #f8f8f2">table</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">daal_table</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">table</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getNumPartitions</span><span style="color: #f92672">(),</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">rdim</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">numThreads</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">converter</span><span style="color: #f92672">.</span><span style="color: #a6e22e">HarpToDaalDouble</span><span style="color: #f92672">();</span>
</pre></div>

<h2 id="how-to-compile-and-run-harp-daal-application:e39afa43d8f438ef1a106319b10ff5f3">How to Compile and Run Harp-DAAL Application ?</h2>

<h3 id="installation-of-daal-framework:e39afa43d8f438ef1a106319b10ff5f3">Installation of DAAL framework</h3>

<p>There are two options to install DAAL library for Harp-DAAL</p>

<ol>
<li><p>Installation from latest Intel DAAL source code (<a href="https://github.com/01org/daal">https://github.com/01org/daal</a>)</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e"># clone from Intel Github repository</span>
git clone git@github.com:01org/daal.git
<span style="color: #75715e"># enter the src directory</span>
<span style="color: #f8f8f2">cd</span> daal
<span style="color: #75715e"># compile and install</span>
make daal <span style="color: #f8f8f2">PLAT</span><span style="color: #f92672">=</span>lnx32e
<span style="color: #75715e"># setup the DAALROOT environment variables use intel64 or ia32</span>
<span style="color: #f8f8f2">source</span> __release_lnx/daal/bin/daalvars.sh intel64
</pre></div></li>

<li><p>Installation from optimized DAAL source code within DSC-SPIDAL/harp (Recommended)</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e"># enter the harp root directory</span>
<span style="color: #f8f8f2">cd</span> harp
<span style="color: #75715e"># pull the daal src (as a submodule)</span>
git submodule update --init --recursive
<span style="color: #75715e"># enter daal src directory</span>
<span style="color: #f8f8f2">cd</span> <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/ml/daal/daal-src
<span style="color: #75715e"># compile and install</span>
make daal <span style="color: #f8f8f2">PLAT</span><span style="color: #f92672">=</span>lnx32e
<span style="color: #75715e"># setup the DAALROOT environment variables</span>
<span style="color: #f8f8f2">source</span> ../__release_lnx/daal/bin/daalvars.sh intel64 
</pre></div>

<p>The DAAL source code within DSC-SPIDAL/harp has some modifications upon a certain version of Intel DAAL source code.
The current source code is based on Intel DAAL version 2018 beta update1. Installation from Intel DAAL latest version
may accelerate the performance of harp-daal, however, it may also cause compilation errors if Intel
change some of the DAAL Java APIs. Therefore, we recommend users to use the tested DAAL stable version provided by our
repository. Some harp-daal codes like MF-SGD contains DAAL native implementation codes that are not yet included to Intel DAAL repository,
and users can only run them with installation of DAAL codes from DSC-SPIDAL/harp.
In addition, our DAAL codes provide users of exclusive optimized data structures for machine learning algorithms
with big model.</p></li>

<li><p>Update daal-src submodule
If users choose second option and install the submodule daal-src of DSC-SPIDAL/harp. The daal-src points to a
certain commit of our DAAL code version. If users would like to explore the latest updates of our DAAL code
please make <a href="https://github.com/francktcheng/Harp-DAAL-Local.git">https://github.com/francktcheng/Harp-DAAL-Local.git</a> as a remote upstream repository and git pull daal_2018_beta_update1
branch</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">cd</span> harp/ml/daal/daal-src
git remote -v 
git remote rename origin upstream 
git pull upstream daal_2018_beta_update1:daal_2018_beta_update1
git checkout daal_2018_beta_update1
</pre></div></li>
</ol>

<h3 id="compile-and-run-harp-daal-applications:e39afa43d8f438ef1a106319b10ff5f3">Compile and Run Harp-DAAL Applications</h3>

<ol>
<li><p>Add harp-daal-interface module back to harp/core/pom.xml file</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">&lt;modules&gt;</span>
    <span style="color: #f92672">&lt;module&gt;</span>harp-collective<span style="color: #f92672">&lt;/module&gt;</span>
    <span style="color: #f92672">&lt;module&gt;</span>harp-hadoop<span style="color: #f92672">&lt;/module&gt;</span>
    <span style="color: #f92672">&lt;module&gt;</span>harp-daal-interface<span style="color: #f92672">&lt;/module&gt;</span>
<span style="color: #f92672">&lt;/modules&gt;</span>
</pre></div></li>

<li><p>Add daal module back to harp/ml/pom.xml file</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">&lt;modules&gt;</span>
    <span style="color: #f92672">&lt;module&gt;</span>java<span style="color: #f92672">&lt;/module&gt;</span>
    <span style="color: #f92672">&lt;module&gt;</span>daal<span style="color: #f92672">&lt;/module&gt;</span>
<span style="color: #f92672">&lt;/modules&gt;</span>
</pre></div></li>

<li><p>Add external daal lib dependency to harp/core/pom.xml and harp/ml/pom.xml files.
The daal.jar file contains the Java APIs provided by DAAL to its native kernels</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">&lt;dependency&gt;</span>
<span style="color: #f92672">&lt;groupId&gt;</span>daal<span style="color: #f92672">&lt;/groupId&gt;</span>
<span style="color: #f92672">&lt;artifactId&gt;</span>daal<span style="color: #f92672">&lt;/artifactId&gt;</span>
<span style="color: #f92672">&lt;scope&gt;</span>system<span style="color: #f92672">&lt;/scope&gt;</span>
<span style="color: #f92672">&lt;version&gt;</span>1.0<span style="color: #f92672">&lt;/version&gt;</span>
<span style="color: #f92672">&lt;systemPath&gt;</span>${DAALROOT}/lib/daal.jar<span style="color: #f92672">&lt;/systemPath&gt;</span>
<span style="color: #f92672">&lt;/dependency&gt;</span>
</pre></div></li>

<li><p>Re-compile harp to generate harp-daal targets. Select the profile related to your hadoop version. For ex: hadoop-2
.6.0. Supported hadoop versions are 2.6.0, 2.7.5 and 2.9.0</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">cd</span> harp/
mvn clean package -Phadoop-2.6.0
</pre></div>

<p>The generated harp-daal-interface jar is at <code>$HARP_ROOT_DIR/core/harp-daal-interface/target</code> folder and the
harp-daal jar is at <code>$HARP_ROOT_DIR/ml/daal/target/</code> folder.</p></li>

<li><p>Run harp-daal frome NameNode of the launched Hadoop daemons</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e"># copy harp-daal jar file to Hadoop directory</span>
cp <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/core/harp-daal-interface/target/harp-daal-interface-0.1.0.jar <span style="color: #e6db74">${</span><span style="color: #f8f8f2">HADOOP_HOME</span><span style="color: #e6db74">}</span>/share/hadoop/mapreduce
cp <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/ml/daal/target/harp-daal-0.1.0.jar <span style="color: #e6db74">${</span><span style="color: #f8f8f2">HADOOP_HOME</span><span style="color: #e6db74">}</span>
<span style="color: #75715e"># enter hadoop home directory</span>
<span style="color: #f8f8f2">cd</span> <span style="color: #e6db74">${</span><span style="color: #f8f8f2">HADOOP_HOME</span><span style="color: #e6db74">}</span>
<span style="color: #75715e"># put daal and tbb, omp libs to hdfs, they will be loaded into the distributed cache of </span>
<span style="color: #75715e"># running harp mappers</span>
hdfs dfs -mkdir -p /Hadoop/Libraries
hdfs dfs -rm /Hadoop/Libraries/*
hdfs dfs -put <span style="color: #e6db74">${</span><span style="color: #f8f8f2">DAALROOT</span><span style="color: #e6db74">}</span>/lib/intel64_lin/libJavaAPI.so /Hadoop/Libraries/
hdfs dfs -put <span style="color: #e6db74">${</span><span style="color: #f8f8f2">TBBROOT</span><span style="color: #e6db74">}</span>/lib/intel64_lin/gcc4.4/libtbb* /Hadoop/Libraries/
hdfs dfs -put <span style="color: #e6db74">${</span><span style="color: #f8f8f2">DAALROOT</span><span style="color: #e6db74">}</span>/../../daal-misc/lib/libiomp5.so /Hadoop/Libraries/
<span style="color: #75715e"># set up path to the DAAL Java APIs lib</span>
<span style="color: #f8f8f2">export</span> <span style="color: #f8f8f2">LIBJARS</span><span style="color: #f92672">=</span><span style="color: #e6db74">${</span><span style="color: #f8f8f2">DAALROOT</span><span style="color: #e6db74">}</span>/lib/daal.jar
<span style="color: #75715e"># launch mappers, e.g., harp-daal-als </span>
bin/hadoop jar harp-daal-0.1.0.jar edu.iu.daal_als.ALSDaalLauncher -libjars <span style="color: #e6db74">${</span><span style="color: #f8f8f2">LIBJARS</span><span style="color: #e6db74">}</span> 
/Hadoop/sgd-input/yahoomusic-train <span style="color: #ae81ff">100</span> <span style="color: #ae81ff">1</span> <span style="color: #ae81ff">0</span>.0001 <span style="color: #ae81ff">10</span> <span style="color: #f8f8f2">false</span> <span style="color: #ae81ff">2</span> <span style="color: #ae81ff">24</span> <span style="color: #ae81ff">110000</span> /Hadoop/als-work /Hadoop/sgd-input/yahoomusic-test
</pre></div>

<p>command line arguments vary from app to app, please refer to the src of harp-daal
there is also a test_scripts directory under /ml/daal/, which contains example scripts to run each harp-daal
application.</p></li>
</ol>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>