<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="Data Interfaces and Types"><meta property="og:url" content="/docs/programming/data-interface/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Data Interfaces and Types</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png" width="76%"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Documentation</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion-1" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="installation-guide" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-1" href="#collapse-installation-guide" aria-labelledby="installation-guide"><i class="fa fa-caret-right"></i>Installation Guide</a></h4></section><div id="collapse-installation-guide" class="panel-collapse collapse" aria-labelledby="installation-guide"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/prerequisites">Prerequisites</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation (Single Node)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started-cluster">Harp Installation (Cluster)</a></li></ul></div></div></div></div></nav><nav class="hn-sidebar-nav"><div id="hn-accordion-2" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="beginners-guide" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-2" href="#collapse-beginners-guide" aria-labelledby="beginners-guide"><i class="fa fa-caret-right"></i>Beginners Guide</a></h4></section><div id="collapse-beginners-guide" class="panel-collapse collapse" aria-labelledby="beginners-guide"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/beginnersguide/mlr">Multiclass Logistic Regression</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Users Guide</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-2" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-2" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/mf">Matrix Factorization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/sahad">Subgraph Counting</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Contributors Guide</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-3" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">Broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">Reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">Allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">Allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">Regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">Push &amp; Pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">Rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/rf">Random Forests</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/nn">Neural Network</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Harp-DAAL Documentation</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-4" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="overview" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-overview" aria-labelledby="overview"><i class="fa fa-caret-right"></i>Overview</a></h4></section><div id="collapse-overview" class="panel-collapse collapse" aria-labelledby="overview"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Harp-DAAL framework</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal-apis" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-harp-daal-apis" aria-labelledby="harp-daal-apis"><i class="fa fa-caret-right"></i>Harp-DAAL APIs</a></h4></section><div id="collapse-harp-daal-apis" class="panel-collapse collapse" aria-labelledby="harp-daal-apis"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaalInit">Initialization Module</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaalIO">I/O Module</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaalComm">Communication Module</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/BatchModeEg">Batch Mode Code Walk Through</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/DistriModeEg">Distributed Mode Code Walk Through</a></li></ul></div></div></div><div class="panel panel-default"><section id="algorithms" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-algorithms" aria-labelledby="algorithms"><i class="fa fa-caret-right"></i>Algorithms</a></h4></section><div id="collapse-algorithms" class="panel-collapse collapse" aria-labelledby="algorithms"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#arpos">Association Rule</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#covpos">Covariance</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#boostpos">Boosting</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#naivepos">Naive Bayes Classifier</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#kmeanspos">K-Means Clustering</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#empos">Expectation-Maximization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#pcapos">Principal Component Analysis</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#svdpos">Singular Value Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#qrpos">QR Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#pqrpos">Pivoted-QR Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#ckdpos">Cholesky Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#mompos">Low Order Moments</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#odpos">Outlier Detection</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#sortpos">Sorting</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#qtepos">Quantile</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#qmpos">Quality Metrics</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#optpos">Optimization Solvers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#normpos">Normalization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#svmpos">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#knnpos">K-Nearest Neighbors Classifier</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#dtreepos">Decision Tree</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#dforestpos">Decision Forest</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#kernelfuncpos">Kernel Functions</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#stumppos">Stump Weak Learner Classifier</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#linregpos">Linear Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#reregpos">Ridge Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#alspos">Implicit Alternating Least Squares</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/algorithms#nnpos">Neural Network</a></li></ul></div></div></div><div class="panel panel-default"><section id="algorithms-experimental" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-algorithms-experimental" aria-labelledby="algorithms-experimental"><i class="fa fa-caret-right"></i>Algorithms Experimental</a></h4></section><div id="collapse-algorithms-experimental" class="panel-collapse collapse" aria-labelledby="algorithms-experimental"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/MF-SGD">Recommender System based on SGD</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Subgraph">Subgraph Counting</a></li></ul></div></div></div><div class="panel panel-default"><section id="hands-on" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-hands-on" aria-labelledby="hands-on"><i class="fa fa-caret-right"></i>Hands-on</a></h4></section><div id="collapse-hands-on" class="panel-collapse collapse" aria-labelledby="hands-on"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/handson">Tutorial</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Data Interfaces and Types</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p><img src="https://dsc-spidal.github.io/harp/img/2-2-1.png" alt="data-abstraction" /></p>

<p>Harp provides three levels of data structures: arrays and objects, partition, and table. Arrays and Serializable objects are the basic data structures, which include:</p>

<ol>
<li><p><code>ByteArray</code>: an array with byte-type elements</p></li>

<li><p><code>ShortArray</code>: an array with short-type elements</p></li>

<li><p><code>IntArray</code>: an array with int-type elements</p></li>

<li><p><code>FloatArray</code>: an array with float-type elements</p></li>

<li><p><code>LongArray</code>: an array with long-type elements</p></li>

<li><p><code>DoubleArray</code>: an array with double-type elements</p></li>

<li><p><code>Writable</code>: serializable object</p></li>
</ol>

<p><code>Partition</code> is a wraper of the data structures shown above. Every partition has an ID. In collective communication, partitions from different processors with the same ID will be merged. The merge operation is defined by <code>PartitionCombiner</code>.</p>

<p><code>Table</code> is a container for partitions. It is a high-level data structure and the unit for collective communication.</p>

<h1 id="table-and-partitions">Table and Partitions</h1>

<p><img src="https://dsc-spidal.github.io/harp/img/3-1-2.png" alt="table-partition" /></p>

<p>An example of how to construct a table is:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">table</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DoubleArrPlus</span><span style="color: #f92672">());</span>
<span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">numPartitions</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>
    <span style="color: #f8f8f2">DoubleArray</span> <span style="color: #f8f8f2">array</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">.</span><span style="color: #a6e22e">create</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">size</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">false</span><span style="color: #f92672">);</span>
    <span style="color: #f8f8f2">table</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addPartition</span><span style="color: #f92672">(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Partition</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">array</span><span style="color: #f92672">));</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>In this example, it initiliazes a table which carries <code>DoubleArray</code> as the primitive data type. <code>DoubleArrPlus</code> is a <code>PartitionCombiner</code> used to define the merging operation of two partitions.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">public</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">DoubleArrPlus</span> <span style="color: #66d9ef">extends</span> <span style="color: #f8f8f2">PartitionCombiner</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f92672">{</span>
    <span style="color: #66d9ef">public</span> <span style="color: #f8f8f2">PartitionStatus</span> <span style="color: #a6e22e">combine</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">DoubleArray</span> <span style="color: #f8f8f2">curPar</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">DoubleArray</span> <span style="color: #f8f8f2">newPar</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
        <span style="color: #66d9ef">double</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">doubles1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">curPar</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">();</span> <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">size1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">curPar</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span><span style="color: #f92672">();</span>
        <span style="color: #66d9ef">double</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">doubles2</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">newPar</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">();</span> <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">size2</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">newPar</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span><span style="color: #f92672">();</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">size1</span> <span style="color: #f92672">!=</span> <span style="color: #f8f8f2">size2</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>            <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">PartitionStatus</span><span style="color: #f92672">.</span><span style="color: #a6e22e">COMBINE_FAILED</span><span style="color: #f92672">;</span>
        <span style="color: #f92672">}</span>
        <span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">size2</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">doubles1</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">doubles1</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">]</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">doubles2</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">];</span>
        <span style="color: #f92672">}</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">PartitionStatus</span><span style="color: #f92672">.</span><span style="color: #a6e22e">COMBINED</span><span style="color: #f92672">;</span>
   <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<h1 id="data-abstraction">Data Abstraction</h1>

<p><img src="https://dsc-spidal.github.io/harp/img/3-1-3.png" alt="data-types" /></p>

<p>The data abstraction is shown above. <code>Transferable</code> is ae higher interface compare to other data structures and <code>Simple</code> is the sub-interface for all primitive data structures. Here is an example of the primitive data strucutres.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">/*</span>
<span style="color: #75715e"> * Copyright 2013-2016 Indiana University</span>
<span style="color: #75715e"> * </span>
<span style="color: #75715e"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span style="color: #75715e"> * you may not use this file except in compliance with the License.</span>
<span style="color: #75715e"> * You may obtain a copy of the License at</span>
<span style="color: #75715e"> *</span>
<span style="color: #75715e"> *     http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="color: #75715e"> *</span>
<span style="color: #75715e"> * Unless required by applicable law or agreed to in writing, software</span>
<span style="color: #75715e"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="color: #75715e"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="color: #75715e"> * See the License for the specific language governing permissions and</span>
<span style="color: #75715e"> * limitations under the License.</span>
<span style="color: #75715e"> */</span>

<span style="color: #f92672">package</span> <span style="color: #f8f8f2">edu.iu.harp.resource</span><span style="color: #f92672">;</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.io.DataOutput</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.io.IOException</span><span style="color: #f92672">;</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">edu.iu.harp.io.DataType</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">edu.iu.harp.resource.Array</span><span style="color: #f92672">;</span>

<span style="color: #75715e">/*******************************************************</span>
<span style="color: #75715e"> * IntArray class for managing int[] data.</span>
<span style="color: #75715e"> ******************************************************/</span>
<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">final</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">IntArray</span> <span style="color: #66d9ef">extends</span> <span style="color: #f8f8f2">Array</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">int</span><span style="color: #f92672">[]&gt;</span> <span style="color: #f92672">{</span>

    <span style="color: #66d9ef">public</span> <span style="color: #a6e22e">IntArray</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">arr</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">start</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">size</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
	<span style="color: #66d9ef">super</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">arr</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">start</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">size</span><span style="color: #f92672">);</span>
    <span style="color: #f92672">}</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Get the number of Bytes of encoded data. One byte for storing DataType,</span>
<span style="color: #75715e">     * four bytes for storing the size, size*4 bytes for storing the data.</span>
<span style="color: #75715e">     */</span>
    <span style="color: #a6e22e">@Override</span>
    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">int</span> <span style="color: #a6e22e">getNumEnocdeBytes</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
	<span style="color: #66d9ef">return</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span> <span style="color: #f92672">*</span> <span style="color: #ae81ff">4</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">5</span><span style="color: #f92672">;</span>
    <span style="color: #f92672">}</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Encode the array as DataOutput</span>
<span style="color: #75715e">     */</span>
    <span style="color: #a6e22e">@Override</span>
    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">encode</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">DataOutput</span> <span style="color: #f8f8f2">out</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span> <span style="color: #f92672">{</span>
	<span style="color: #f8f8f2">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeByte</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">DataType</span><span style="color: #f92672">.</span><span style="color: #a6e22e">INT_ARRAY</span><span style="color: #f92672">);</span>
	<span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">len</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">start</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">size</span><span style="color: #f92672">;</span>
	<span style="color: #f8f8f2">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeInt</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">size</span><span style="color: #f92672">);</span>
	<span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">start</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">len</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>
	    <span style="color: #f8f8f2">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeInt</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">array</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">]);</span>
	<span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Create an array. Firstly try to get an array from ResourcePool; if</span>
<span style="color: #75715e">     * failed, new an array.</span>
<span style="color: #75715e">     * </span>
<span style="color: #75715e">     * @param len</span>
<span style="color: #75715e">     * @param approximate</span>
<span style="color: #75715e">     * @return</span>
<span style="color: #75715e">     */</span>
    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">IntArray</span> <span style="color: #a6e22e">create</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">len</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">boolean</span> <span style="color: #f8f8f2">approximate</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
	<span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">len</span> <span style="color: #f92672">&gt;</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
	    <span style="color: #66d9ef">int</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">ints</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ResourcePool</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getIntsPool</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getArray</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">len</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">approximate</span><span style="color: #f92672">);</span>
	    <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">ints</span> <span style="color: #f92672">!=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
		<span style="color: #66d9ef">return</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">IntArray</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">ints</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">len</span><span style="color: #f92672">);</span>
	    <span style="color: #f92672">}</span> <span style="color: #66d9ef">else</span> <span style="color: #f92672">{</span>
		<span style="color: #66d9ef">return</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
	    <span style="color: #f92672">}</span>
	<span style="color: #f92672">}</span> <span style="color: #66d9ef">else</span> <span style="color: #f92672">{</span>
	    <span style="color: #66d9ef">return</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Release the array from the ResourcePool</span>
<span style="color: #75715e">     */</span>
    <span style="color: #a6e22e">@Override</span>
    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">release</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
	<span style="color: #f8f8f2">ResourcePool</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getIntsPool</span><span style="color: #f92672">().</span><span style="color: #a6e22e">releaseArray</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">array</span><span style="color: #f92672">);</span>
	<span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">reset</span><span style="color: #f92672">();</span>
    <span style="color: #f92672">}</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Free the array from the ResourcePool</span>
<span style="color: #75715e">     */</span>
    <span style="color: #a6e22e">@Override</span>
    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">free</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
	<span style="color: #f8f8f2">ResourcePool</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getIntsPool</span><span style="color: #f92672">().</span><span style="color: #a6e22e">freeArray</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">array</span><span style="color: #f92672">);</span>
	<span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">reset</span><span style="color: #f92672">();</span>

    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>