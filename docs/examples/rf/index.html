<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="Harp Random Forests"><meta property="og:url" content="/docs/examples/rf/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Harp Random Forests</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png" width="76%"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Documentation</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion-1" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="installation-guide" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-1" href="#collapse-installation-guide" aria-labelledby="installation-guide"><i class="fa fa-caret-right"></i>Installation Guide</a></h4></section><div id="collapse-installation-guide" class="panel-collapse collapse" aria-labelledby="installation-guide"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/prerequisites">Prerequisites</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation (Single Node)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started-cluster">Harp Installation (Cluster)</a></li></ul></div></div></div></div></nav><nav class="hn-sidebar-nav"><div id="hn-accordion-2" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="beginners-guide" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-2" href="#collapse-beginners-guide" aria-labelledby="beginners-guide"><i class="fa fa-caret-right"></i>Beginners Guide</a></h4></section><div id="collapse-beginners-guide" class="panel-collapse collapse" aria-labelledby="beginners-guide"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/beginnersguide/mlr">Multiclass Logistic Regression</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Users Guide</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-2" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-2" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/mf">Matrix Factorization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/sahad">Subgraph Counting</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Contributors Guide</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-3" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">Broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">Reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">Allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">Allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">Regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">Push &amp; Pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">Rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-3" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/rf">Random Forests</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/nn">Neural Network</a></li></ul></div></div></div></div></nav><h2 class="panel-title"><b>Harp-DAAL Documentation</b></h2><br><nav class="hn-sidebar-nav"><div id="hn-accordion-4" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="overview" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-overview" aria-labelledby="overview"><i class="fa fa-caret-right"></i>Overview</a></h4></section><div id="collapse-overview" class="panel-collapse collapse" aria-labelledby="overview"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Harp-DAAL framework</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal-apis" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-harp-daal-apis" aria-labelledby="harp-daal-apis"><i class="fa fa-caret-right"></i>Harp-DAAL APIs</a></h4></section><div id="collapse-harp-daal-apis" class="panel-collapse collapse" aria-labelledby="harp-daal-apis"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaalInit">Initialization Module</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaalIO">I/O Module</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaalComm">Communication Module</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/BatchModeEg">Batch Mode Code Walk Through</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/DistriModeEg">Distributed Mode Code Walk Through</a></li></ul></div></div></div><div class="panel panel-default"><section id="algorithms-stable" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-algorithms-stable" aria-labelledby="algorithms-stable"><i class="fa fa-caret-right"></i>Algorithms Stable</a></h4></section><div id="collapse-algorithms-stable" class="panel-collapse collapse" aria-labelledby="algorithms-stable"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/AssociationRule">Association Rule</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Covariance">Covariance</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Boosting">Boosting</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/NaiveBayes">Naive Bayes Classifier</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/KmeansClustering">K-Means Clustering</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/EM">Expectation-Maximization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/PCA">Principal Component Analysis</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/SVD">Singular Value Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/QR">QR Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/PQR">Pivoted-QR Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Cholesky">Cholesky Decomposition</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/LowOrderMom">Low Order Moments</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/OutlierDetection">Outlier Detection</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Sorting">Sorting</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Quantile">Quantile</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Quality-Metrics">Quality Metrics</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Optimization-Solvers">Optimization Solvers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Normalization">Normalization</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/SVM">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Knn">K-Nearest Neighbors Classifier</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Dtree">Decision Tree</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Dforest">Decision Forest</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Kernel-Functions">Kernel Functions</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Stump">Stump Weak Learner Classifier</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/LinearRegression">Linear Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/RidgeRegression">Ridge Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/ALS">Implicit Alternating Least Squares</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/NN">Neural Network</a></li></ul></div></div></div><div class="panel panel-default"><section id="algorithms-experimental" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-algorithms-experimental" aria-labelledby="algorithms-experimental"><i class="fa fa-caret-right"></i>Algorithms Experimental</a></h4></section><div id="collapse-algorithms-experimental" class="panel-collapse collapse" aria-labelledby="algorithms-experimental"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/MF-SGD">Recommender System based on SGD</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Subgraph">Subgraph Counting</a></li></ul></div></div></div><div class="panel panel-default"><section id="hands-on" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion-4" href="#collapse-hands-on" aria-labelledby="hands-on"><i class="fa fa-caret-right"></i>Hands-on</a></h4></section><div id="collapse-hands-on" class="panel-collapse collapse" aria-labelledby="hands-on"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/handson">Tutorial</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Harp Random Forests</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p>Before going through this tutorial take a look at the <a href="https://dsc-spidal.github.io/harp/docs/examples/overview/">overview</a> section.</p>

<p><img src="https://dsc-spidal.github.io/harp/img/4-5-1.png" width="60%"  ></p>

<p>Random forests are an ensemble learning method for classification, regression and other tasks that operate by constructing a multitude of decision trees at training time and outputting the class that is the mode of the classes (classification) or mean prediction (regression) of the individual trees. Random decision forests correct for decision trees&rsquo; habit of overfitting to their training set.</p>

<p>The training algorithm for random forests applies the general technique of bootstrap aggregating, or bagging, to tree learners. Given a training set <code>X</code> with responses <code>Y</code>, bagging repeatedly selects a random sample with replacement of the training set. After training, predictions for unseen samples can be made by averaging the predictions from all the individual regression trees or by taking the majority vote in the case of decision trees. Random forests can also do another bagging &ndash; feature bagging, which is a random subset of the features. The reason for doing this is the correlation of the trees in an ordinary bootstrap sample: if one or a few features are very strong predictors for the response variable (target output), these features will be selected in many of the B trees, causing them to become correlated.</p>

<h2 id="definition">DEFINITION</h2>

<ul>
<li><code>N</code> is the number of data points</li>
<li><code>M</code> is the number of selected features</li>
<li><code>K</code> is the number of trees</li>
</ul>

<h2 id="method">METHOD</h2>

<p>The following is the procedure of Harp Random Forests training:</p>

<ol>
<li><p>Randomly select <code>N</code> samples with replacement for <code>K</code> trees (totally <code>K</code> times).</p></li>

<li><p>Select <code>M</code> features randomly which will be used in decision tree.</p></li>

<li><p>Build decision tree based on these <code>M</code> features</p></li>

<li><p>Repeat Step 2 and 3 <code>K</code> times.</p></li>
</ol>

<p>The predicting part will use these decision trees to predict <code>K</code> results. For regression, the result is the average of each tree&rsquo;s result and for classification, the majority vote will be the output.</p>

<p>This tutorial extends a random forest implementation of a popular java machine learning library <a href="http://java-ml.sourceforge.net/">javaml</a> from a shared memory version into a distributed version.</p>

<h2 id="step-0-data-bootstraping">Step 0 &mdash; Data Bootstraping</h2>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">// create bootstrap samples for each tree</span>
<span style="color: #f8f8f2">Dataset</span> <span style="color: #f8f8f2">baggingDataset</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DefaultDataset</span><span style="color: #f92672">();</span>
<span style="color: #f8f8f2">Random</span> <span style="color: #f8f8f2">rand</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Random</span><span style="color: #f92672">();</span>
<span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">dataset</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span><span style="color: #f92672">();</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>
	<span style="color: #f8f8f2">baggingDataset</span><span style="color: #f92672">.</span><span style="color: #a6e22e">add</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">dataset</span>
		<span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">rand</span><span style="color: #f92672">.</span><span style="color: #a6e22e">nextInt</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">dataset</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span><span style="color: #f92672">())));</span>
<span style="color: #f92672">}</span>
</pre></div>

<h2 id="step-1-train-forests">Step 1 &mdash;Train forests</h2>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">// each thread build one decision tree </span>
<span style="color: #f8f8f2">Classifier</span> <span style="color: #f8f8f2">rf</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">RandomForest</span><span style="color: #f92672">(</span><span style="color: #ae81ff">1</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">false</span><span style="color: #f92672">,</span>
  <span style="color: #f8f8f2">numFeatures</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Random</span><span style="color: #f92672">());</span>
<span style="color: #f8f8f2">rf</span><span style="color: #f92672">.</span><span style="color: #a6e22e">buildClassifier</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">dataset</span><span style="color: #f92672">);</span>
</pre></div>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">//private DynamicScheduler&lt;Dataset, Classifier, RFTask&gt; rfScheduler;</span>

<span style="color: #f8f8f2">rfScheduler</span><span style="color: #f92672">.</span><span style="color: #a6e22e">start</span><span style="color: #f92672">();</span> 
<span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">numTrees</span>
		<span style="color: #f92672">/</span> <span style="color: #f8f8f2">numMapTasks</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>
	<span style="color: #f8f8f2">Dataset</span> <span style="color: #f8f8f2">baggingDataset</span> <span style="color: #f92672">=</span>
		<span style="color: #f8f8f2">Util</span><span style="color: #f92672">.</span><span style="color: #a6e22e">doBagging</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainDataset</span><span style="color: #f92672">);</span>
	<span style="color: #f8f8f2">rfScheduler</span><span style="color: #f92672">.</span><span style="color: #a6e22e">submit</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainDataset</span><span style="color: #f92672">);</span>
<span style="color: #f92672">}</span> 

<span style="color: #66d9ef">while</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">rfScheduler</span><span style="color: #f92672">.</span><span style="color: #a6e22e">hasOutput</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
	<span style="color: #f8f8f2">rfClassifier</span> 
	<span style="color: #f92672">.</span><span style="color: #a6e22e">add</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">rfScheduler</span><span style="color: #f92672">.</span><span style="color: #a6e22e">waitForOutput</span><span style="color: #f92672">());</span>

<span style="color: #f92672">}</span>
<span style="color: #f8f8f2">rfScheduler</span><span style="color: #f92672">.</span><span style="color: #a6e22e">stop</span><span style="color: #f92672">();</span>
</pre></div>

<h2 id="step-2-synchronize-majority-vote">Step 2 &mdash; Synchronize majority vote</h2>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">Instance</span> <span style="color: #f8f8f2">testData</span> <span style="color: #f92672">:</span> <span style="color: #f8f8f2">testDataset</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
	<span style="color: #f8f8f2">IntArray</span> <span style="color: #f8f8f2">votes</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">IntArray</span><span style="color: #f92672">.</span><span style="color: #a6e22e">create</span><span style="color: #f92672">(</span><span style="color: #ae81ff">2</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">false</span><span style="color: #f92672">);</span>
	<span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">Classifier</span> <span style="color: #f8f8f2">rf</span> <span style="color: #f92672">:</span> <span style="color: #f8f8f2">rfClassifier</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
		<span style="color: #f8f8f2">Object</span> <span style="color: #f8f8f2">classValue</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">rf</span><span style="color: #f92672">.</span><span style="color: #a6e22e">classify</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">testData</span><span style="color: #f92672">);</span>
		<span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">classValue</span><span style="color: #f92672">.</span><span style="color: #a6e22e">toString</span><span style="color: #f92672">().</span><span style="color: #a6e22e">equals</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;0&quot;</span><span style="color: #f92672">))</span> <span style="color: #f92672">{</span>
			<span style="color: #f8f8f2">votes</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">()[</span><span style="color: #ae81ff">0</span><span style="color: #f92672">]</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">;</span>
		<span style="color: #f92672">}</span> <span style="color: #66d9ef">else</span> <span style="color: #f92672">{</span>
			<span style="color: #f8f8f2">votes</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">()[</span><span style="color: #ae81ff">1</span><span style="color: #f92672">]</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">;</span>
		<span style="color: #f92672">}</span>
	<span style="color: #f92672">}</span>
	<span style="color: #f8f8f2">Partition</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">IntArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">partition</span> <span style="color: #f92672">=</span>
		<span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Partition</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">IntArray</span><span style="color: #f92672">&gt;(</span><span style="color: #f8f8f2">partitionId</span><span style="color: #f92672">,</span>
				<span style="color: #f8f8f2">votes</span><span style="color: #f92672">);</span>
	<span style="color: #f8f8f2">predictTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addPartition</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">partition</span><span style="color: #f92672">);</span>
	<span style="color: #f8f8f2">partitionId</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">;</span>

<span style="color: #f92672">}</span>

<span style="color: #f8f8f2">reduce</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;main&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;reduce&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">predictTable</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">);</span>
<span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">isMaster</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
	<span style="color: #f8f8f2">printResults</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">predictTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">testDataset</span><span style="color: #f92672">);</span>

<span style="color: #f92672">}</span>
</pre></div>

<h1 id="run-example">Run example</h1>

<h3 id="data">Data</h3>

<p>The dataset used is sampled from <a href="http://stat-computing.org/dataexpo/2009/">Aireline</a> dataset. Refer to the <a href="https://github.com/DSC-SPIDAL/harp/tree/master/datasets/tutorial/airline">dataset</a> directory for more details.</p>

<p>The format for the data should be a list of &lt;DAY_OF_WEEK DEP_DELAY DEP_DELAY_NEW DEP_DELAY_GROUP ARR_DELAY ARR_DELAY_NEW UNIQUE_CARRIER_ID ORIGIN_STATE_ABR_ID DEST_STATE_ABR_ID CLASS&gt;. For example,</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">1</span> <span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span> <span style="color: #ae81ff">0</span> <span style="color: #ae81ff">10</span> <span style="color: #ae81ff">10</span> <span style="color: #ae81ff">15</span> <span style="color: #ae81ff">10</span> <span style="color: #ae81ff">20</span> <span style="color: #ae81ff">0</span>
<span style="color: #ae81ff">1</span> -3 <span style="color: #ae81ff">0</span> -1 -24 <span style="color: #ae81ff">0</span> <span style="color: #ae81ff">15</span> <span style="color: #ae81ff">10</span> <span style="color: #ae81ff">20</span> <span style="color: #ae81ff">0</span>
</pre></div>

<h3 id="put-data-on-hdfs">Put data on hdfs</h3>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>hdfs dfs -mkdir /data/airline
rm -rf data
mkdir -p data
<span style="color: #f8f8f2">cd</span> data
split -l <span style="color: #ae81ff">74850</span> <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/datasets/tutorial/airline/train.csv
<span style="color: #f8f8f2">cd</span> ..
hdfs dfs -put data /data/airline
hdfs dfs -put <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/datasets/tutorial/airline/test.csv /data/airline/
</pre></div>

<h3 id="compile">Compile</h3>

<p>Select the profile related to your hadoop version. For ex: hadoop-2.6.0. Supported hadoop versions are 2.6.0, 2.7.5
and 2.9.0</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">cd</span> <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>
mvn clean package -Phadoop-2.6.0
</pre></div>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">cd</span> <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/contrib/target
cp contrib-0.1.0.jar <span style="color: #f8f8f2">$HADOOP_HOME</span>
cp <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/third_parity/javaml-0.1.7.jar <span style="color: #f8f8f2">$HADOOP_HOME</span>/share/hadoop/mapreduce
cp <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/third_parity/ajt-2.11.jar <span style="color: #f8f8f2">$HADOOP_HOME</span>/share/hadoop/mapreduce
<span style="color: #f8f8f2">cd</span> <span style="color: #f8f8f2">$HADOOP_HOME</span>
</pre></div>

<h3 id="run">Run</h3>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>hadoop jar contrib-0.1.0.jar edu.iu.rf.RFMapCollective 
Usage: edu.iu.rf.RFMapCollective &lt;numTrees&gt; &lt;numMapTasks&gt; &lt;numThreads&gt; &lt;trainPath&gt; &lt;testPath&gt; &lt;outputPath&gt;
</pre></div>

<h3 id="example">Example</h3>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>hadoop jar contrib-0.1.0.jar edu.iu.rf.RFMapCollective <span style="color: #ae81ff">32</span> <span style="color: #ae81ff">2</span> <span style="color: #ae81ff">16</span> /data/airline/data/ /data/airline/test.csv /out
</pre></div>

<p>This will start 2 mappers with 16 threads in each mapper to build 32 decision trees. The accuracy of prediction on the test dataset is the output.</p>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>