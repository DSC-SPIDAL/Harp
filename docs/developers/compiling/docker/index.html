<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@heronstreaming"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="Compiling With Docker"><meta property="og:url" content="/docs/developers/compiling/docker/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Compiling With Docker</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="getting-started" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-getting-started" aria-labelledby="getting-started"><i class="fa fa-caret-right"></i>Getting Started</a></h4></section><div id="collapse-getting-started" class="panel-collapse collapse" aria-labelledby="getting-started"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-concepts" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-concepts" aria-labelledby="harp-concepts"><i class="fa fa-caret-right"></i>Harp Concepts</a></h4></section><div id="collapse-harp-concepts" class="panel-collapse collapse" aria-labelledby="harp-concepts"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/concepts/features">Features</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/concepts/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="data-interfaces-and-types" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-data-interfaces-and-types" aria-labelledby="data-interfaces-and-types"><i class="fa fa-caret-right"></i>Data Interfaces and Types</a></h4></section><div id="collapse-data-interfaces-and-types" class="panel-collapse collapse" aria-labelledby="data-interfaces-and-types"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/data-interface">Data Interfaces and Types</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="schedulers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-schedulers" aria-labelledby="schedulers"><i class="fa fa-caret-right"></i>Schedulers</a></h4></section><div id="collapse-schedulers" class="panel-collapse collapse" aria-labelledby="schedulers"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/scheduler/static-scheduler">Static Scheduler</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/scheduler/dynamic-scheduler">Dynamic Scheduler</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">k-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/allreducekmeans">allreduce k-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/bcastreducekmeans">broadcast &amp; reduce k-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/pushpullkmeans">push &amp; pull k-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/regroupallgatherkmeans">regroup &amp; allgather k-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/latentdirichletallocation">latent dirichlet allocation</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">LDA</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">SVM</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Harp-DAAL</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Example">Example</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/contributors">Contributors</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Compiling With Docker</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p>For developing Heron, you will need to compile it for the environment that you
want to use it in. If you&rsquo;d like to use Docker to create that build environment,
Heron provides a convenient script to make that process easier.</p>

<p>Currently, only Ubuntu 14.04, Ubuntu 15.10, and CentOS 7 are supported, but if you
need another platform there are instructions for adding new ones
<a href="#contributing-new-environments">below</a>.</p>

<h3 id="requirements">Requirements</h3>

<ul>
<li><a href="https://docs.docker.com">Docker</a></li>
</ul>

<h3 id="running-docker-in-a-virtual-machine">Running Docker in a Virtual Machine</h3>

<p>If you are running Docker in a virtual machine (VM), it is recommended that you
adjust your settings to help speed up the build. To do this, open
<a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a> and go to the container
in which Docker is running (usually &ldquo;default&rdquo; or whatever name you used to
create the VM), click on the VM, and then click on <strong>Settings</strong>.</p>

<p><strong>Note</strong>: You will need to stop the VM before modifying these settings.</p>

<p><img src="https://dsc-spidal.github.io/harp/img/virtual-box-processors.png" alt="VirtualBox Processors" />
<img src="https://dsc-spidal.github.io/harp/img/virtual-box-memory.png" alt="VirtualBox Memory" /></p>

<h2 id="building-heron">Building Heron</h2>

<p>Heron provides a <code>build-arfifacts.sh</code> script for Docker located in the
<code>docker</code> folder. To run that script:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ <span style="color: #f8f8f2">cd</span> /path/to/heron/repo
$ docker/build-artifacts.sh
</pre></div>

<p>Running the script by itself will display usage information:</p>

<pre><code>Usage: docker/build-artifacts.sh &lt;platform&gt; &lt;version_string&gt; [source-tarball] &lt;output-directory&gt;

Platforms Supported: darwin, ubuntu14.04, ubuntu15.10, centos7

Example:
  ./build-artifacts.sh ubuntu14.04 0.12.0 .

NOTE: If running on OSX, the output directory will need to
      be under /Users so virtualbox has access to.
</code></pre>

<p>The following arguments are required:</p>

<ul>
<li><code>platform</code> &mdash; Currently, this can be one of: <code>ubuntu14.04</code>, <code>centos7</code>. You
can add other platforms using the <a href="#contributing-new-environments">instructions
below</a>.</li>
<li><code>version-string</code> &mdash; The Heron release for which you&rsquo;d like to build
artifacts.</li>
<li><code>output-directory</code> &mdash; The directory in which you&rsquo;d like the release to be
built.</li>
</ul>

<p>Here&rsquo;s an example usage:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ docker/build-artifacts.sh ubuntu14.04 0.12.0 ~/heron-release
</pre></div>

<p>This will build a Docker container specific to Ubuntu 14.04, create a source
tarball of the Heron repository, run a full release build of Heron, and then
copy the artifacts into the <code>~/heron-release</code> directory.</p>

<p>Optionally, you can also include a tarball of the Heron source if you have one.
By default, the script will create a tarball of the current source in the Heron
repo and use that to build the artifacts.</p>

<p><strong>Note</strong>: If you are running on Mac OS X, Docker must be run inside a VM.
Therefore, you must make sure that both the source tarball and destination
directory are somewhere under your home directory. For example, you cannot
output the Heron artifacts to <code>/tmp</code> because <code>/tmp</code> refers to the directory
inside the VM, not on the host machine. Your home directory, however, is
automatically linked in to the VM and can be accessed normally.</p>

<p>After the build has completed, you can go to your output directory and see all
of the generated artifacts:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ ls ~/heron-release
heron-api-0.12.0-ubuntu14.04.tar.gz
heron-client-0.12.0-ubuntu14.04.tar.gz
heron-tools-0.12.0-ubuntu14.04.tar.gz
heron-client-install-0.12.0-ubuntu.sh  
heron-tools-install-0.12.0-ubuntu.sh
heron-api-install-0.12.0-ubuntu.sh     
heron-core-0.12.0-ubuntu.tar.gz
</pre></div>

<h2 id="contributing-new-environments">Contributing New Environments</h2>

<p>You&rsquo;ll notice that there are multiple
<a href="https://docs.docker.com/engine/reference/builder/">Dockerfiles</a> in the <code>docker</code>
directory of Heron&rsquo;s source code, one for each of the currently supported
platforms.</p>

<p>To add support for a new platform, add a new <code>Dockerfile</code> to that directory and
append the name of the platform to the name of the file. If you&rsquo;d like to add
support for Debian 8, for example, add a file named <code>Dockerfile.debian8</code>. Once
you&rsquo;ve done that, follow the instructions in the <a href="https://docs.docker.com/engine/articles/dockerfile_best-practices/">Docker
documentation</a>.</p>

<p>You should make sure that your <code>Dockerfile</code> specifies <em>at least</em> all of the
following:</p>

<h3 id="step-1-the-os-being-used-in-a-from-https-docs-docker-com-engine-reference-builder-from-statement">Step 1 &mdash; The OS being used in a <a href="https://docs.docker.com/engine/reference/builder/#from"><code>FROM</code></a> statement.</h3>

<p>Here&rsquo;s an example:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">FROM</span><span style="color: #e6db74"> centos:centos7</span>
</pre></div>

<h3 id="step-2-a-target-platform-environment-variable-using-the-env-https-docs-docker-com-engine-reference-builder-env-instruction">Step 2 &mdash; A <code>TARGET_PLATFORM</code> environment variable using the <a href="https://docs.docker.com/engine/reference/builder/#env"><code>ENV</code></a> instruction.</h3>

<p>Here&rsquo;s an example:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">ENV</span><span style="color: #e6db74"> TARGET_PLATFORM centos</span>
</pre></div>

<h3 id="step-3-a-general-dependency-installation-script-using-a-run-https-docs-docker-com-engine-reference-builder-run-instruction">Step 3 &mdash; A general dependency installation script using a <a href="https://docs.docker.com/engine/reference/builder/#run"><code>RUN</code></a> instruction.</h3>

<p>Here&rsquo;s an example:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">RUN</span> apt-get update <span style="color: #f92672">&amp;&amp;</span> apt-get -y install <span style="color: #ae81ff">\</span>
         automake <span style="color: #ae81ff">\</span>
         build-essential <span style="color: #ae81ff">\</span>
         cmake <span style="color: #ae81ff">\</span>
         curl <span style="color: #ae81ff">\</span>
         libssl-dev <span style="color: #ae81ff">\</span>
         git <span style="color: #ae81ff">\</span>
         libtool <span style="color: #ae81ff">\</span>
         libunwind8 <span style="color: #ae81ff">\</span>
         libunwind-setjmp0-dev <span style="color: #ae81ff">\</span>
         python <span style="color: #ae81ff">\</span>
         python2.7-dev <span style="color: #ae81ff">\</span>
         python-software-properties <span style="color: #ae81ff">\</span>
         software-properties-common <span style="color: #ae81ff">\</span>
         python-setuptools <span style="color: #ae81ff">\</span>
         unzip <span style="color: #ae81ff">\</span>
         wget
</pre></div>

<h3 id="step-4-an-installation-script-for-java-8-and-a-java-home-environment-variable">Step 4 &mdash; An installation script for Java 8 and a <code>JAVA_HOME</code> environment variable</h3>

<p>Here&rsquo;s an example:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">RUN</span> <span style="color: #ae81ff">\</span>
     <span style="color: #f8f8f2">echo</span> oracle-java8-installer shared/accepted-oracle-license-v1-1 <span style="color: #66d9ef">select</span> <span style="color: #f8f8f2">true</span> <span style="color: #f8f8f2">|</span> debconf-set-selections <span style="color: #f92672">&amp;&amp;</span> <span style="color: #ae81ff">\</span>
     add-apt-repository -y ppa:webupd8team/java <span style="color: #f92672">&amp;&amp;</span> <span style="color: #ae81ff">\</span>
     apt-get update <span style="color: #f92672">&amp;&amp;</span> <span style="color: #ae81ff">\</span>
     apt-get install -y oracle-java8-installer <span style="color: #f92672">&amp;&amp;</span> <span style="color: #ae81ff">\</span>
     rm -rf /var/lib/apt/lists/* <span style="color: #f92672">&amp;&amp;</span> <span style="color: #ae81ff">\</span>
     rm -rf /var/cache/oracle-jdk8-installer

<span style="color: #66d9ef">ENV</span><span style="color: #e6db74"> JAVA_HOME /usr/lib/jvm/java-8-oracle</span>
</pre></div>

<h4 id="step-5-an-installation-script-for-bazel-http-bazel-io-version-hahahugoshortcode-1hbhb-or-above">Step 5 - An installation script for <a href="http://bazel.io/">Bazel</a> version  or above.</h4>

<p>Here&rsquo;s an example:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">RUN</span> wget -O /tmp/bazel.sh https://github.com/bazelbuild/bazel/releases/download/0.3.1/bazel-0.3.1-installer-linux-x86_64.sh <span style="color: #ae81ff">\</span>
         <span style="color: #f92672">&amp;&amp;</span> chmod +x /tmp/bazel.sh <span style="color: #ae81ff">\</span>
         <span style="color: #f92672">&amp;&amp;</span> /tmp/bazel.sh
</pre></div>

<h3 id="step-6-add-the-bazelrc-configuration-file-for-bazel-and-the-compile-sh-script-from-the-docker-folder-that-compiles-heron">Step 6 &mdash; Add the <code>bazelrc</code> configuration file for Bazel and the <code>compile.sh</code> script (from the <code>docker</code> folder) that compiles Heron</h3>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">ADD</span><span style="color: #e6db74"> bazelrc /root/.bazelrc</span>
<span style="color: #66d9ef">ADD</span><span style="color: #e6db74"> compile.sh /compile.sh</span>
</pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>